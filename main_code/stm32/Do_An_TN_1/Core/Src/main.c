/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * Copyright (c) 2024 STMicroelectronics.
  * All rights reserved.
  *
  * This software is licensed under terms that can be found in the LICENSE file
  * in the root directory of this software component.
  * If no LICENSE file comes with this software, it is provided AS-IS.
  *
  ******************************************************************************
  */
/* USER CODE END Header */
/* Includes ------------------------------------------------------------------*/
#include "main.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include "PID_Control.h"  // Thư viện PID Controller
#include "Fuzzy_01.h"  // Thư viện Fuzzy Controller
#include "PID_XY.h"  // Thư viện PID xy theta
#include "math.h"
#include "string.h"
#include <stdio.h>
#include "ssd1306.h"
#include "ssd1306_tests.h"
#include "ssd1306_fonts.h"
/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */

/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */
#define RxSIZE 6
#define Max_Array_XY 3000
/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */

/* USER CODE END PM */

/* Private variables ---------------------------------------------------------*/
I2C_HandleTypeDef hi2c1;
I2C_HandleTypeDef hi2c2;

SPI_HandleTypeDef hspi1;

TIM_HandleTypeDef htim1;
TIM_HandleTypeDef htim2;
TIM_HandleTypeDef htim3;
TIM_HandleTypeDef htim4;
TIM_HandleTypeDef htim5;
TIM_HandleTypeDef htim6;
TIM_HandleTypeDef htim8;
TIM_HandleTypeDef htim9;
TIM_HandleTypeDef htim10;
TIM_HandleTypeDef htim11;

UART_HandleTypeDef huart1;
UART_HandleTypeDef huart2;

/* USER CODE BEGIN PV */
/************************************************* Fuzzy Variable  **********************************************/
 // Tạo Input theo lần lược từ thấp đến lớn với mỗi mảng có 3 giá trị Input[x][3]
 float IN_01[5][3] = {{-1000000, -0.8, -0.5}, {-0.8, -0.5, 0}, {-0.2, 0, 0.2}, {0, 0.5, 0.8}, {0.5, 0.8, 1000000}};
 float IN_02[5][3] = {{-1000000, -0.6, -0.2}, {-0.3, -0.2, 0}, {-0.2, 0, 0.2}, {0, 0.2, 0.4}, {0.2, 0.6, 1000000}};
 //{{-1000000, -0.6, -0.4}, {-0.6, -0.4, 0}, {-0.1, 0, 0.1}, {0, 0.4, 0.6}, {0.5, 0.8, 1000000}};x2
 //{{-1000000, -0.8, -0.5}, {-0.8, -0.5, 0}, {-0.2, 0, 0.2}, {0, 0.5, 0.8}, {0.5, 0.8, 1000000}};x2
// //1.0
// float IN_01[5][3] = {{-1000000, -0.8, -0.5}, {-0.8, -0.5, 0}, {-0.2, 0, 0.2}, {0, 0.5, 0.8}, {0.5, 0.8, 1000000}};
// float IN_02[5][3] = {{-1000000, -0.6, -0.2}, {-0.3, -0.2, 0}, {-0.2, 0, 0.2}, {0, 0.2, 0.4}, {0.2, 0.6, 1000000}};
 // Tạo Output
 float OUT_01[5] = {-1, -0.3, 0, 0.3, 1};
 float o1;
 // Tạo mảng cho ID và giá trị của ID so sánh
 int8_t ID1[5], ID2[5];
 float Value_ID_1[5], Value_ID_2[5];
 // Tạo mảng lưu Output
 float Temp_01[25][2];
 float Temp_02[2];
 float Output_PWM_Fuzzy;
 float Output_PWM_Fuzzy_Temp;
 float error_integration_fuzzy; // Tích phân của sai số cho tính toán fuzzy
 float error_integration_fuzzy_P; // Giá trị trước
 float e1, e2;

 // Oled
 float a_float = 0.0;
 uint16_t ax1, ay1;
 char str10[10];
 uint16_t x_1, y_1;
 uint16_t Radius;

 // I2C
 uint8_t RxData[RxSIZE];
 uint32_t a_00 ;
 float dec;
 uint8_t exponent;
 uint64_t mu;
 uint8_t bit_end = 0;
 float Mang_quy_dao_X[Max_Array_XY];  // Mang chua cac quy dao x
 float Mang_quy_dao_Y[Max_Array_XY];  // Mang chua cac quy dao y
 float Mang_quy_dao_X_m[Max_Array_XY];  // Mang chua cac quy dao x
 float Mang_quy_dao_Y_m[Max_Array_XY];  // Mang chua cac quy dao y
 uint16_t Num_X, Num_Y; // Bien dem cua X vs Y
 float real_num;
 uint32_t Num_Array = 0 ;
 uint8_t First_4_bits, Second_4_bits;
 uint8_t Start_bit_1,  Start_bit_2;


 // Duy Nhat
 /******************************************************************************/
 char str1[50];
 char buffer1[50]; // �?ịnh nghĩa một mảng char đủ lớn để chứa kết quả
 int length1;

 char str2[50];
 char buffer2[50];
 int length2;

 char str3[50];
 char buffer3[50];
 int length3;

 char str4[50];
 char buffer4[50];
 int length4;

 char str5[50];
 char buffer5[50];
 int length5;

 char str6[50];
 char buffer6[50];
 int length6;

 float t = 0.0;
 double a1,a2,a3,a4,a5,a6 ;
 float b1,b2,b3,b4,b5,b6 ;
 double a = 0.0;
 int count;

 float c1, c2, c3, c4;
 uint8_t Data_001[]  = "s";
 uint8_t Size_Data ;

 /******************************************************************************/
 float EX, EY, E_Velocity, Error_Distance;

 /************************************************* Mobile Robot Variable  **********************************************/

 // Thông số toán h�?c
 float PI = 3.1415926535897932;
 float Time_Interrupt_global = 0.05; // Th�?i gian ngắt toàn cục

 // Thông số quỹ đạo
	float Delta_S = 0.00001; // Khoảng cách giữa hai điểm x và x+1
	float a_0 = 0.5;
	float b = 0.0;
	float Mang_Robot_1[2][2] = {{0,0},{0,0}};
	uint32_t Vi_tri_1 = 0;
	float ek_mm, ek_degree;
	float Stepper_L;
	float Time_10 = 0;
	float Khoang_cach_mm_1;

	// Stepper
	int32_t Counter_AC;
	int32_t Diem_dung = 0;
	int8_t DIR;



	float AY[] = {
	        -5.01000, -4.51000, -4.01000, -3.51000, -3.01000, -2.51000, -2.01000, -1.51000, -1.01000, -0.51000,
	        -0.01000, 0.49000, 0.99000, 1.49000, 1.99000, 2.49000, 2.99000, 3.49000, 3.99000, 4.49000,
	        4.99000, 5.49000, 5.99000, 6.49000, 6.99000, 7.49000, -4.01000, -3.51000, -3.01000, -2.51000,
	        -2.01000, -1.51000, -1.01000, -0.51000, -0.01000, 0.49000, 0.99000, 1.49000, -4.01000, -3.51000,
	        -3.01000, -2.51000, -2.01000, -4.01000, -3.51000, -3.01000, -2.51000, -2.01000, -1.51000, -1.01000,
	        -0.51000, -0.01000, 0.49000, 0.99000, 1.49000, 1.99000, 2.49000, 2.99000, 3.49000, 3.99000,
	        4.49000, 4.99000, 5.49000, 5.99000, 6.49000, 6.99000, 7.49000, 7.99000, 8.49000, -3.01000,
	        -2.51000, -2.01000, -1.51000, -1.01000, -0.51000, -0.01000, 0.49000, 0.99000, 1.49000, 1.99000,
	        2.49000, -3.01000, -2.51000, -2.01000, -1.51000, -1.01000, -3.01000, -2.51000, -2.01000, -1.51000,
	        -1.01000, -0.51000, -0.01000, 0.49000, 0.99000, 1.49000, 1.99000, 2.49000, 2.99000, 3.49000,
	        3.99000, 4.49000, 4.99000, 5.49000, 5.99000, 6.49000, 6.99000, 7.49000, 7.99000, 8.49000,
	        8.99000, 9.49000, -2.01000, -1.51000, -1.01000, -0.51000, -0.01000, 0.49000, 0.99000, 1.49000,
	        1.99000, 2.49000, 2.99000, 3.49000, -2.01000, -1.51000, -1.01000, -0.51000, -0.01000, -2.01000,
	        -1.51000, -1.01000, -0.51000, -0.01000, 0.49000, 0.99000, 1.49000, 1.99000, 2.49000, 2.99000,
	        3.49000, 3.99000, 4.49000, 4.99000, 5.49000, 5.99000, 6.49000, 6.99000, 7.49000, 7.99000,
	        8.49000, 8.99000, 9.49000, 9.99000, 10.49000, -1.01000, -0.51000, -0.01000, 0.49000, 0.99000,
	        1.49000, 1.99000, 2.49000, 2.99000, 3.49000, 3.99000, 4.49000, -1.01000, -0.51000, -0.01000,
	        0.49000, 0.99000, -1.01000, -0.51000, -0.01000, 0.49000, 0.99000, 1.49000, 1.99000, 2.49000,
	        2.99000, 3.49000, 3.99000, 4.49000, 4.99000, 5.49000, 5.99000, 6.49000, 6.99000, 7.49000,
	        7.99000, 8.49000, 8.99000, 9.49000, 9.99000, 10.49000, 10.99000, 11.49000, -0.01000, 0.49000,
	        0.99000, 1.49000, 1.99000, 2.49000, 2.99000, 3.49000, 3.99000, 4.49000, 4.99000, 5.49000,
	        -0.01000, 0.49000
	    };
	float AX[] = {
	        -0.128985332, 0.766782498, 1.462317328, 1.974269158, 2.319287988, 2.514023818, 2.575126648, 2.519246478,
	        2.363033308, 2.123137138, 1.816207968, 1.458895798, 1.067850628, 0.659722458, 0.251161288, -0.141182882,
	        -0.500660052, -0.810620222, -1.054413392, -1.215389562, -1.276898732, -1.222290902, -1.034916072,
	        -0.698124242, -0.195265412, 0.490310418, 1.462317328, 1.974269158, 2.319287988, 2.514023818, 2.575126648,
	        2.519246478, 2.363033308, 2.123137138, 1.816207968, 1.458895798, 1.067850628, 0.659722458, 1.462317328,
	        1.974269158, 2.319287988, 2.514023818, 2.575126648, 1.462317328, 1.974269158, 2.319287988, 2.514023818,
	        2.575126648, 2.519246478, 2.363033308, 2.123137138, 1.816207968, 1.458895798, 1.067850628, 0.659722458,
	        0.251161288, -0.141182882, -0.500660052, -0.810620222, -1.054413392, -1.215389562, -1.276898732,
	        -1.222290902, -1.034916072, -0.698124242, -0.195265412, 0.490310418, 1.375253248, 2.476213078, 2.319287988,
	        2.514023818, 2.575126648, 2.519246478, 2.363033308, 2.123137138, 1.816207968, 1.458895798, 1.067850628,
	        0.659722458, 0.251161288, -0.141182882, 2.319287988, 2.514023818, 2.575126648, 2.519246478, 2.363033308,
	        2.319287988, 2.514023818, 2.575126648, 2.519246478, 2.363033308, 2.123137138, 1.816207968, 1.458895798,
	        1.067850628, 0.659722458, 0.251161288, -0.141182882, -0.500660052, -0.810620222, -1.054413392, -1.215389562,
	        -1.276898732, -1.222290902, -1.034916072, -0.698124242, -0.195265412, 0.490310418, 1.375253248, 2.476213078,
	        3.809839908, 5.392783738, 2.575126648, 2.519246478, 2.363033308, 2.123137138, 1.816207968, 1.458895798,
	        1.067850628, 0.659722458, 0.251161288, -0.141182882, -0.500660052, -0.810620222, 2.575126648, 2.519246478,
	        2.363033308, 2.123137138, 1.816207968, 2.575126648, 2.519246478, 2.363033308, 2.123137138, 1.816207968,
	        1.458895798, 1.067850628, 0.659722458, 0.251161288, -0.141182882, -0.500660052, -0.810620222, -1.054413392,
	        -1.215389562, -1.276898732, -1.222290902, -1.034916072, -0.698124242, -0.195265412, 0.490310418, 1.375253248,
	        2.476213078, 3.809839908, 5.392783738, 7.241694568, 9.373222398, 2.363033308, 2.123137138, 1.816207968,
	        1.458895798, 1.067850628, 0.659722458, 0.251161288, -0.141182882, -0.500660052, -0.810620222, -1.054413392,
	        -1.215389562, 2.363033308, 2.123137138, 1.816207968, 1.458895798, 1.067850628, 2.363033308, 2.123137138,
	        1.816207968, 1.458895798, 1.067850628, 0.659722458, 0.251161288, -0.141182882, -0.500660052, -0.810620222,
	        -1.054413392, -1.215389562, -1.276898732, -1.222290902, -1.034916072, -0.698124242, -0.195265412, 0.490310418,
	        1.375253248, 2.476213078, 3.809839908, 5.392783738, 7.241694568, 9.373222398, 11.80401723, 14.55072906,
	        1.816207968, 1.458895798, 1.067850628, 0.659722458, 0.251161288, -0.141182882, -0.500660052, -0.810620222,
	        -1.054413392, -1.215389562, -1.276898732, -1.222290902, 1.816207968, 1.458895798
	    };
//	float AY[] = {-5.01, -4.51, -4.01, -3.51, -3.01, -2.51, -2.01, -1.51, -1.01, -0.51, -0.01, 0.49, 0.99, 1.49, 1.99, 2.49, 2.99, 3.49, 3.99, 4.49, 4.99, 5.49, 5.99, 6.49, 6.99, 7.49, 7.99, 8.49, 8.99, 9.49, 9.99, 10.49, 10.99, 11.49, 11.99, 12.49, 12.99, 13.49, 13.99, 14.49, 14.99, 15.49, 15.99, 16.49, 16.99, 17.49, 17.99, 18.49, 18.99, 19.49, 19.99, 20.49, 20.99, 21.49, 21.99, 22.49, 22.99, 23.49, 23.99, 24.49, 24.99, 25.49, 25.99, 26.49, 26.99, 27.49, 27.99, 28.49, 28.99, 29.49, 29.99, 30.49, 30.99, 31.49, 31.99, 32.49, 32.99, 33.49, 33.99, 34.49, 34.99, 35.49, 35.99, 36.49, 36.99, 37.49, 37.99, 38.49, 38.99, 39.49, 39.99, 40.49, 40.99, 41.49, 41.99, 42.49, 42.99, 43.49, 43.99, 44.49, 44.99, 45.49, 45.99, 46.49, 46.99, 47.49, 47.99, 48.49, 48.99, 49.49, 49.99, 50.49, 50.99, 51.49, 51.99, 52.49, 52.99, 53.49, 53.99, 54.49, 54.99, 55.49, 55.99, 56.49, 56.99, 57.49, 57.99, 58.49, 58.99, 59.49, 59.99, 60.49, 60.99, 61.49, 61.99, 62.49, 62.99, 63.49, 63.99, 64.49, 64.99, 65.49, 65.99, 66.49, 66.99, 67.49, 67.99, 68.49, 68.99, 69.49, 69.99, 70.49, 70.99, 71.49, 71.99, 72.49, 72.99, 73.49, 73.99, 74.49, 74.99, 75.49, 75.99, 76.49, 76.99, 77.49, 77.99, 78.49, 78.99, 79.49, 79.99, 80.49, 80.99, 81.49, 81.99, 82.49, 82.99, 83.49, 83.99, 84.49, 84.99, 85.49, 85.99, 86.49, 86.99, 87.49, 87.99, 88.49, 88.99, 89.49, 89.99, 90.49, 90.99, 91.49, 91.99, 92.49, 92.99, 93.49, 93.99, 94.49, 94.99, 95.49, 95.99, 96.49, 96.99, 97.49, 97.99, 98.49, 98.99, 99.49, 99.99, 100.49};
//	float AX[] ={-0.128985332, 0.766782498, 1.462317328, 1.974269158, 2.319287988, 2.514023818, 2.575126648, 2.519246478, 2.363033308, 2.123137138, 1.816207968, 1.458895798, 1.067850628, 0.659722458, 0.251161288, -0.141182882, -0.500660052, -0.810620222, -1.054413392, -1.215389562, -1.276898732, -1.222290902, -1.034916072, -0.698124242, -0.195265412, 0.490310418, 1.375253248, 2.476213078, 3.809839908, 5.392783738, 7.241694568, 9.373222398, 11.80401723, 14.55072906, 17.63000789, 21.05850372, 24.85286655, 29.02974638, 33.60579321, 38.59765704, 44.02198787, 49.8954357, 56.23465053, 63.05628236, 70.37698119, 78.21339702, 86.58217985, 95.49997968, 104.9834465, 115.0492303, 125.7139812, 136.994349, 148.9069838, 161.4685357, 174.6956545, 188.6049903, 203.2131931, 218.536913, 234.5927998, 251.3975036, 268.9676745, 287.3199623, 306.4710171, 326.437489, 347.2360278, 368.8832836, 391.3959064, 414.7905463, 439.0838531, 464.2924769, 490.4330678, 517.5222756, 545.5767504, 574.6131423, 604.6481011, 635.6982769, 667.7803197, 700.9108796, 735.1066064, 770.3841502, 806.7601611, 844.2512889, 882.8741837, 922.6454956, 963.5818744, 1005.69997, 1049.016433, 1093.547913, 1139.31106, 1186.322524, 1234.598954, 1284.157002, 1335.013317, 1387.184549, 1440.687348, 1495.538364, 1551.754246, 1609.351646, 1668.347213, 1728.757597, 1790.599448, 1853.889415, 1918.64415, 1984.880302, 2052.614521, 2121.863457, 2192.64376, 2264.972079, 2338.865066, 2414.33937, 2491.411641, 2570.098529, 2650.416684, 2732.382755, 2816.013394, 2901.32525, 2988.334973, 3077.059213, 3167.51462, 3259.717843, 3353.685534, 3449.434342, 3546.980917, 3646.341909, 3747.533968, 3850.573743, 3955.477886, 4062.263046, 4170.945873, 4281.543017, 4394.071128, 4508.546855, 4624.98685, 4743.407762, 4863.826241, 4986.258937, 5110.7225, 5237.233579, 5365.808826, 5496.46489, 5629.218421, 5764.086069, 5901.084484, 6040.230315, 6181.540214, 6325.03083, 6470.718813, 6618.620813, 6768.75348, 6921.133463, 7075.777414, 7232.701982, 7391.923817, 7553.459569, 7717.325887, 7883.539423, 8052.116826, 8223.074746, 8396.429833, 8572.198737, 8750.398107, 8931.044595, 9114.15485, 9299.745522, 9487.833261, 9678.434717, 9871.566539, 10067.24538, 10265.48789, 10466.31071, 10669.7305, 10875.76391, 11084.42758, 11295.73818, 11509.71233, 11726.36671, 11945.71795, 12167.78271, 12392.57764, 12620.11938, 12850.42459, 13083.50992, 13319.39202, 13558.08753, 13799.61311, 14043.9854, 14291.22107, 14541.33675, 14794.34909, 15050.27476, 15309.13039, 15570.93264, 15835.69815, 16103.44358, 16374.18558, 16647.9408, 16924.72588, 17204.55748, 17487.45225, 17773.42683, 18062.49788, 18354.68205, 18649.99598, 18948.45634, 19250.07975, 19554.88289, 19862.88239, 20174.09491, 20488.5371, 20806.2256, 21127.17707, 21451.40816};

//	float AX[] = {115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.96666666666667, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.73333333333333, 115.73333333333333, 115.73333333333333, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.5, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.26666666666667, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 115.03333333333333, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.8, 114.56666666666666, 114.8, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.56666666666666, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.33333333333333, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 114.10000000000001, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.86666666666667, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.63333333333334, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.4, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 113.16666666666667, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.93333333333334, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.46666666666667, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.7, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.23333333333333, 112.46666666666667, 112.46666666666667, 112.46666666666667, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.23333333333333, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 112.0, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.76666666666667, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.76666666666667, 111.76666666666667, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.53333333333333, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.3, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 111.06666666666666, 110.83333333333333, 110.83333333333333, 110.83333333333333, 110.83333333333333, 110.83333333333333, 110.83333333333333, 111.06666666666666, 111.06666666666666, 110.83333333333333, 110.83333333333333, 110.83333333333333, 110.83333333333333, 110.83333333333333, 110.83333333333333};
//	float AY[] = {0.0, 0.23076923076923078, 0.46153846153846156, 0.6923076923076923, 0.9230769230769231, 1.153846153846154, 1.3846153846153846, 1.6153846153846154, 1.8461538461538463, 2.076923076923077, 2.307692307692308, 2.5384615384615388, 2.769230769230769, 3.0, 3.230769230769231, 3.4615384615384617, 3.6923076923076925, 3.9230769230769234, 4.153846153846154, 4.384615384615385, 4.615384615384616, 4.846153846153847, 5.0769230769230775, 5.307692307692308, 5.538461538461538, 5.769230769230769, 6.0, 6.230769230769231, 6.461538461538462, 6.6923076923076925, 6.923076923076923, 7.153846153846154, 7.384615384615385, 7.615384615384616, 7.846153846153847, 8.076923076923077, 8.307692307692308, 8.538461538461538, 8.76923076923077, 9.0, 9.230769230769232, 9.461538461538462, 9.692307692307693, 9.923076923076923, 10.153846153846155, 10.384615384615385, 10.615384615384617, 10.846153846153847, 11.076923076923077, 11.307692307692308, 11.538461538461538, 11.76923076923077, 12.0, 12.230769230769232, 12.461538461538462, 12.692307692307693, 12.923076923076923, 13.153846153846155, 13.384615384615385, 13.615384615384617, 13.846153846153847, 14.076923076923078, 14.307692307692308, 14.53846153846154, 14.76923076923077, 15.0, 15.230769230769232, 15.461538461538462, 15.692307692307693, 15.923076923076923, 16.153846153846153, 16.384615384615387, 16.615384615384617, 16.846153846153847, 17.076923076923077, 17.30769230769231, 17.53846153846154, 17.76923076923077, 18.0, 18.230769230769234, 18.461538461538463, 18.692307692307693, 18.923076923076923, 19.153846153846153, 19.384615384615387, 19.615384615384617, 19.846153846153847, 20.076923076923077, 20.30769230769231, 20.53846153846154, 20.76923076923077, 21.0, 21.230769230769234, 21.461538461538463, 21.692307692307693, 21.923076923076923, 22.153846153846153, 22.384615384615387, 22.615384615384617, 22.846153846153847, 23.076923076923077, 23.30769230769231, 23.53846153846154, 23.76923076923077, 24.0, 24.230769230769234, 24.461538461538463, 24.692307692307693, 24.923076923076923, 25.153846153846157, 25.384615384615387, 25.615384615384617, 25.846153846153847, 26.076923076923077, 26.30769230769231, 26.53846153846154, 26.76923076923077, 27.0, 27.230769230769234, 27.461538461538463, 27.692307692307693, 27.923076923076923, 28.153846153846157, 28.384615384615387, 28.615384615384617, 28.846153846153847, 29.07692307692308, 29.30769230769231, 29.53846153846154, 29.76923076923077, 30.0, 30.230769230769234, 30.461538461538463, 30.692307692307693, 30.923076923076923, 31.153846153846157, 31.384615384615387, 31.615384615384617, 31.846153846153847, 32.07692307692308, 32.30769230769231, 32.53846153846154, 32.769230769230774, 33.0, 33.23076923076923, 33.46153846153846, 33.69230769230769, 33.92307692307693, 34.15384615384615, 34.38461538461539, 34.61538461538462, 34.84615384615385, 35.07692307692308, 35.30769230769231, 35.53846153846154, 35.769230769230774, 36.0, 36.23076923076923, 36.46153846153847, 36.69230769230769, 36.92307692307693, 37.15384615384615, 37.38461538461539, 37.61538461538462, 37.84615384615385, 38.07692307692308, 38.30769230769231, 38.53846153846154, 38.769230769230774, 39.0, 39.23076923076923, 39.46153846153847, 39.69230769230769, 39.92307692307693, 40.15384615384615, 40.38461538461539, 40.61538461538462, 40.84615384615385, 41.07692307692308, 41.30769230769231, 41.53846153846154, 41.769230769230774, 42.0, 42.23076923076923, 42.46153846153847, 42.69230769230769, 42.92307692307693, 43.15384615384615, 43.38461538461539, 43.61538461538462, 43.84615384615385, 44.07692307692308, 44.30769230769231, 44.53846153846154, 44.769230769230774, 45.0, 45.23076923076923, 45.46153846153847, 45.69230769230769, 45.92307692307693, 46.15384615384615, 46.38461538461539, 46.61538461538462, 46.84615384615385, 47.07692307692308, 47.307692307692314, 47.53846153846154, 47.769230769230774, 48.0, 48.23076923076923, 48.46153846153847, 48.69230769230769, 48.92307692307693, 49.15384615384615, 49.38461538461539, 49.61538461538462, 49.84615384615385, 50.07692307692308, 50.307692307692314, 50.53846153846154, 50.769230769230774, 51.0, 51.23076923076923, 51.46153846153847, 51.69230769230769, 51.92307692307693, 52.15384615384615, 52.38461538461539, 52.61538461538462, 52.84615384615385, 53.07692307692308, 53.307692307692314, 53.53846153846154, 53.769230769230774, 54.0, 54.23076923076923, 54.46153846153847, 54.69230769230769, 54.92307692307693, 55.15384615384616, 55.38461538461539, 55.61538461538462, 55.84615384615385, 56.07692307692308, 56.307692307692314, 56.53846153846154, 56.769230769230774, 57.0, 57.23076923076923, 57.46153846153847, 57.69230769230769, 57.92307692307693, 58.15384615384616, 58.38461538461539, 58.61538461538462, 58.84615384615385, 59.07692307692308, 59.307692307692314, 59.53846153846154, 59.769230769230774, 60.0, 60.23076923076923, 60.46153846153847, 60.69230769230769, 60.92307692307693, 61.15384615384616, 61.38461538461539, 61.61538461538462, 61.84615384615385, 62.07692307692308, 62.307692307692314, 62.53846153846154, 62.769230769230774, 63.0, 63.23076923076923, 63.46153846153847, 63.69230769230769, 63.92307692307693, 64.15384615384616, 64.38461538461539, 64.61538461538461, 64.84615384615385, 65.07692307692308, 65.3076923076923, 65.53846153846155, 65.76923076923077, 66.0, 66.23076923076924, 66.46153846153847, 66.6923076923077, 66.92307692307692, 67.15384615384616, 67.38461538461539, 67.61538461538461, 67.84615384615385, 68.07692307692308, 68.3076923076923, 68.53846153846155, 68.76923076923077, 69.0, 69.23076923076924, 69.46153846153847, 69.6923076923077, 69.92307692307693, 70.15384615384616, 70.38461538461539, 70.61538461538461, 70.84615384615385, 71.07692307692308, 71.3076923076923, 71.53846153846155, 71.76923076923077, 72.0, 72.23076923076924, 72.46153846153847, 72.6923076923077, 72.92307692307693, 73.15384615384616, 73.38461538461539, 73.61538461538461, 73.84615384615385, 74.07692307692308, 74.3076923076923, 74.53846153846155, 74.76923076923077, 75.0, 75.23076923076924, 75.46153846153847, 75.6923076923077, 75.92307692307693, 76.15384615384616, 76.38461538461539, 76.61538461538461, 76.84615384615385, 77.07692307692308, 77.3076923076923, 77.53846153846155, 77.76923076923077, 78.0, 78.23076923076924, 78.46153846153847, 78.6923076923077, 78.92307692307693, 79.15384615384616, 79.38461538461539, 79.61538461538461, 79.84615384615385, 80.07692307692308, 80.3076923076923, 80.53846153846155, 80.76923076923077, 81.0, 81.23076923076924, 81.46153846153847, 81.6923076923077, 81.92307692307693, 82.15384615384616, 82.38461538461539, 82.61538461538461, 82.84615384615385, 83.07692307692308, 83.3076923076923, 83.53846153846155, 83.76923076923077, 84.0, 84.23076923076924, 84.46153846153847, 84.6923076923077, 84.92307692307693, 85.15384615384616, 85.38461538461539, 85.61538461538461, 85.84615384615385, 86.07692307692308, 86.3076923076923, 86.53846153846155, 86.76923076923077, 87.0, 87.23076923076924, 87.46153846153847, 87.6923076923077, 87.92307692307693, 88.15384615384616, 88.38461538461539, 88.61538461538461, 88.84615384615385, 89.07692307692308, 89.3076923076923, 89.53846153846155, 89.76923076923077, 90.0, 90.23076923076924, 90.46153846153847, 90.6923076923077, 90.92307692307693, 91.15384615384616, 91.38461538461539, 91.61538461538463, 91.84615384615385, 92.07692307692308, 92.3076923076923, 92.53846153846155, 92.76923076923077, 93.0, 93.23076923076924, 93.46153846153847, 93.6923076923077, 93.92307692307693, 94.15384615384616, 94.38461538461539, 94.61538461538463, 94.84615384615385, 95.07692307692308, 95.3076923076923, 95.53846153846155, 95.76923076923077, 96.0, 96.23076923076924, 96.46153846153847, 96.6923076923077, 96.92307692307693, 97.15384615384616, 97.38461538461539, 97.61538461538463, 97.84615384615385, 98.07692307692308, 98.3076923076923, 98.53846153846155, 98.76923076923077, 99.0, 99.23076923076924, 99.46153846153847, 99.6923076923077, 99.92307692307693, 100.15384615384616, 100.38461538461539, 100.61538461538463, 100.84615384615385, 101.07692307692308, 101.3076923076923, 101.53846153846155, 101.76923076923077, 102.0, 102.23076923076924, 102.46153846153847, 102.6923076923077, 102.92307692307693, 103.15384615384616, 103.38461538461539, 103.61538461538463, 103.84615384615385, 104.07692307692308, 104.3076923076923, 104.53846153846155, 104.76923076923077, 105.0, 105.23076923076924, 105.46153846153847, 105.6923076923077, 105.92307692307693, 106.15384615384616, 106.38461538461539, 106.61538461538463, 106.84615384615385, 107.07692307692308, 107.3076923076923, 107.53846153846155, 107.76923076923077, 108.0, 108.23076923076924, 108.46153846153847, 108.6923076923077, 108.92307692307693, 109.15384615384616, 109.38461538461539, 109.61538461538463, 109.84615384615385, 110.07692307692308, 110.30769230769232, 110.53846153846155, 110.76923076923077, 111.0, 111.23076923076924, 111.46153846153847, 111.6923076923077, 111.92307692307693, 112.15384615384616, 112.38461538461539, 112.61538461538463, 112.84615384615385, 113.07692307692308, 113.30769230769232, 113.53846153846155, 113.76923076923077, 114.0, 114.23076923076924, 114.46153846153847, 114.6923076923077, 114.92307692307693, 115.15384615384616, 115.38461538461539, 115.61538461538463, 115.84615384615385, 116.07692307692308, 116.30769230769232, 116.53846153846155, 116.76923076923077, 117.0, 117.23076923076924, 117.46153846153847, 117.6923076923077, 117.92307692307693, 118.15384615384616, 118.38461538461539, 118.61538461538463, 118.84615384615385, 119.07692307692308, 119.30769230769232, 119.53846153846155, 119.76923076923077, 120.0, 120.23076923076924, 120.46153846153847, 120.6923076923077, 120.92307692307693, 121.15384615384616, 121.38461538461539, 121.61538461538463, 121.84615384615385, 122.07692307692308, 122.30769230769232, 122.53846153846155, 122.76923076923077, 123.0, 123.23076923076924, 123.46153846153847, 123.6923076923077, 123.92307692307693, 124.15384615384616, 124.38461538461539, 124.61538461538463, 124.84615384615385, 125.07692307692308, 125.30769230769232, 125.53846153846155, 125.76923076923077, 126.0, 126.23076923076924, 126.46153846153847, 126.6923076923077, 126.92307692307693, 127.15384615384616, 127.38461538461539, 127.61538461538463, 127.84615384615385, 128.0769230769231, 128.30769230769232, 128.53846153846155, 128.76923076923077, 129.0, 129.23076923076923, 129.46153846153848, 129.6923076923077, 129.92307692307693, 130.15384615384616, 130.3846153846154, 130.6153846153846, 130.84615384615384, 131.0769230769231, 131.30769230769232, 131.53846153846155, 131.76923076923077, 132.0, 132.23076923076923, 132.46153846153848, 132.6923076923077, 132.92307692307693, 133.15384615384616, 133.3846153846154, 133.6153846153846, 133.84615384615384, 134.0769230769231, 134.30769230769232, 134.53846153846155, 134.76923076923077, 135.0, 135.23076923076923, 135.46153846153848, 135.6923076923077, 135.92307692307693, 136.15384615384616, 136.3846153846154, 136.6153846153846, 136.84615384615384, 137.0769230769231, 137.30769230769232, 137.53846153846155, 137.76923076923077, 138.0, 138.23076923076923, 138.46153846153848, 138.6923076923077, 138.92307692307693, 139.15384615384616, 139.3846153846154, 139.6153846153846, 139.84615384615387, 140.0769230769231, 140.30769230769232, 140.53846153846155, 140.76923076923077, 141.0, 141.23076923076923, 141.46153846153848, 141.6923076923077, 141.92307692307693, 142.15384615384616, 142.3846153846154, 142.6153846153846, 142.84615384615387, 143.0769230769231, 143.30769230769232, 143.53846153846155, 143.76923076923077, 144.0, 144.23076923076923, 144.46153846153848, 144.6923076923077, 144.92307692307693, 145.15384615384616, 145.3846153846154, 145.6153846153846, 145.84615384615387, 146.0769230769231, 146.30769230769232, 146.53846153846155, 146.76923076923077, 147.0, 147.23076923076923, 147.46153846153848, 147.6923076923077, 147.92307692307693, 148.15384615384616, 148.3846153846154, 148.6153846153846, 148.84615384615387, 149.0769230769231, 149.30769230769232, 149.53846153846155, 149.76923076923077, 150.0, 150.23076923076923, 150.46153846153848, 150.6923076923077, 150.92307692307693, 151.15384615384616, 151.3846153846154, 151.6153846153846, 151.84615384615387, 152.0769230769231, 152.30769230769232, 152.53846153846155, 152.76923076923077, 153.0, 153.23076923076923, 153.46153846153848, 153.6923076923077, 153.92307692307693, 154.15384615384616, 154.3846153846154, 154.6153846153846, 154.84615384615387, 155.0769230769231, 155.30769230769232, 155.53846153846155, 155.76923076923077, 156.0, 156.23076923076923, 156.46153846153848, 156.6923076923077, 156.92307692307693, 157.15384615384616, 157.3846153846154, 157.6153846153846, 157.84615384615387, 158.0769230769231, 158.30769230769232, 158.53846153846155, 158.76923076923077, 159.0, 159.23076923076923, 159.46153846153848, 159.6923076923077, 159.92307692307693, 160.15384615384616, 160.3846153846154, 160.6153846153846, 160.84615384615387, 161.0769230769231, 161.30769230769232, 161.53846153846155, 161.76923076923077, 162.0, 162.23076923076923, 162.46153846153848, 162.6923076923077, 162.92307692307693, 163.15384615384616, 163.3846153846154, 163.6153846153846, 163.84615384615387, 164.0769230769231, 164.30769230769232, 164.53846153846155, 164.76923076923077, 165.0, 165.23076923076923, 165.46153846153848, 165.6923076923077, 165.92307692307693, 166.15384615384616, 166.3846153846154, 166.6153846153846, 166.84615384615387, 167.0769230769231, 167.30769230769232, 167.53846153846155, 167.76923076923077, 168.0, 168.23076923076923, 168.46153846153848, 168.6923076923077, 168.92307692307693, 169.15384615384616, 169.3846153846154, 169.6153846153846, 169.84615384615387, 170.0769230769231, 170.30769230769232, 170.53846153846155, 170.76923076923077, 171.0, 171.23076923076923, 171.46153846153848, 171.6923076923077, 171.92307692307693, 172.15384615384616, 172.3846153846154, 172.6153846153846, 172.84615384615387, 173.0769230769231, 173.30769230769232, 173.53846153846155, 173.76923076923077, 174.0, 174.23076923076923, 174.46153846153848, 174.6923076923077, 174.92307692307693, 175.15384615384616, 175.3846153846154, 175.6153846153846, 175.84615384615387, 176.0769230769231, 176.30769230769232, 176.53846153846155, 176.76923076923077, 177.0, 177.23076923076923, 177.46153846153848, 177.6923076923077, 177.92307692307693, 178.15384615384616, 178.3846153846154, 178.6153846153846, 178.84615384615387, 179.0769230769231, 179.30769230769232, 179.53846153846155, 179.76923076923077, 180.0, 180.23076923076925, 180.46153846153848, 180.6923076923077, 180.92307692307693, 181.15384615384616, 181.3846153846154, 181.6153846153846, 181.84615384615387, 182.0769230769231, 182.30769230769232, 182.53846153846155, 182.76923076923077, 183.0, 183.23076923076925, 183.46153846153848, 183.6923076923077, 183.92307692307693, 184.15384615384616, 184.3846153846154, 184.6153846153846, 184.84615384615387, 185.0769230769231, 185.30769230769232, 185.53846153846155, 185.76923076923077, 186.0, 186.23076923076925, 186.46153846153848, 186.6923076923077, 186.92307692307693, 187.15384615384616, 187.3846153846154, 187.6153846153846, 187.84615384615387, 188.0769230769231, 188.30769230769232, 188.53846153846155, 188.76923076923077, 189.0, 189.23076923076925, 189.46153846153848, 189.6923076923077, 189.92307692307693, 190.15384615384616, 190.3846153846154, 190.6153846153846, 190.84615384615387, 191.0769230769231, 191.30769230769232, 191.53846153846155, 191.76923076923077, 192.0, 192.23076923076925, 192.46153846153848, 192.6923076923077, 192.92307692307693, 193.15384615384616, 193.3846153846154, 193.6153846153846, 193.84615384615387, 194.0769230769231, 194.30769230769232, 194.53846153846155, 194.76923076923077, 195.0, 195.23076923076925, 195.46153846153848, 195.6923076923077, 195.92307692307693, 196.15384615384616, 196.3846153846154, 196.6153846153846, 196.84615384615387, 197.0769230769231, 197.30769230769232, 197.53846153846155, 197.76923076923077, 198.0, 198.23076923076925, 198.46153846153848, 198.6923076923077, 198.92307692307693, 199.15384615384616, 199.3846153846154, 199.6153846153846, 199.84615384615387, 200.0769230769231, 200.30769230769232, 200.53846153846155, 200.76923076923077, 201.0, 201.23076923076925, 201.46153846153848, 201.6923076923077, 201.92307692307693, 202.15384615384616, 202.3846153846154, 202.6153846153846, 202.84615384615387, 203.0769230769231, 203.30769230769232, 203.53846153846155, 203.76923076923077, 204.0, 204.23076923076925, 204.46153846153848, 204.6923076923077, 204.92307692307693, 205.15384615384616, 205.3846153846154, 205.6153846153846, 205.84615384615387, 206.0769230769231, 206.30769230769232, 206.53846153846155, 206.76923076923077, 207.0, 207.23076923076925, 207.46153846153848, 207.6923076923077, 207.92307692307693, 208.15384615384616, 208.3846153846154, 208.6153846153846, 208.84615384615387, 209.0769230769231, 209.30769230769232, 209.53846153846155, 209.76923076923077, 210.0, 210.23076923076925, 210.46153846153848, 210.6923076923077, 210.92307692307693, 211.15384615384616, 211.3846153846154, 211.6153846153846, 211.84615384615387, 212.0769230769231, 212.30769230769232, 212.53846153846155, 212.76923076923077, 213.0, 213.23076923076925, 213.46153846153848, 213.6923076923077, 213.92307692307693, 214.15384615384616, 214.3846153846154, 214.6153846153846, 214.84615384615387, 215.0769230769231, 215.30769230769232, 215.53846153846155, 215.76923076923077, 216.0, 216.23076923076925, 216.46153846153848, 216.6923076923077, 216.92307692307693, 217.15384615384616, 217.3846153846154, 217.61538461538464, 217.84615384615387, 218.0769230769231, 218.30769230769232, 218.53846153846155, 218.76923076923077, 219.0, 219.23076923076925, 219.46153846153848, 219.6923076923077, 219.92307692307693, 220.15384615384616, 220.3846153846154, 220.61538461538464, 220.84615384615387, 221.0769230769231, 221.30769230769232, 221.53846153846155, 221.76923076923077, 222.0, 222.23076923076925, 222.46153846153848, 222.6923076923077, 222.92307692307693, 223.15384615384616, 223.3846153846154, 223.61538461538464, 223.84615384615387, 224.0769230769231, 224.30769230769232, 224.53846153846155, 224.76923076923077, 225.0, 225.23076923076925, 225.46153846153848, 225.6923076923077, 225.92307692307693, 226.15384615384616, 226.3846153846154, 226.61538461538464, 226.84615384615387, 227.0769230769231, 227.30769230769232, 227.53846153846155, 227.76923076923077, 228.0, 228.23076923076925, 228.46153846153848, 228.6923076923077, 228.92307692307693, 229.15384615384616, 229.3846153846154, 229.61538461538464, 229.84615384615387, 230.0769230769231, 230.30769230769232, 230.53846153846155, 230.76923076923077, 231.0, 231.23076923076925, 231.46153846153848, 231.6923076923077, 231.92307692307693, 232.15384615384616, 232.3846153846154, 232.61538461538464, 232.84615384615387, 233.0769230769231, 233.30769230769232, 233.53846153846155, 233.76923076923077, 234.0, 234.23076923076925, 234.46153846153848, 234.6923076923077, 234.92307692307693, 235.15384615384616, 235.3846153846154, 235.61538461538464, 235.84615384615387, 236.0769230769231, 236.30769230769232, 236.53846153846155, 236.76923076923077, 237.0, 237.23076923076925, 237.46153846153848, 237.6923076923077, 237.92307692307693, 238.15384615384616, 238.3846153846154, 238.61538461538464, 238.84615384615387, 239.0769230769231, 239.30769230769232, 239.53846153846155, 239.76923076923077, 240.0, 240.23076923076925, 240.46153846153848, 240.6923076923077, 240.92307692307693, 241.15384615384616, 241.3846153846154, 241.61538461538464, 241.84615384615387, 242.0769230769231, 242.30769230769232, 242.53846153846155, 242.76923076923077, 243.0, 243.23076923076925, 243.46153846153848, 243.6923076923077, 243.92307692307693, 244.15384615384616, 244.3846153846154, 244.61538461538464, 244.84615384615387, 245.0769230769231, 245.30769230769232, 245.53846153846155, 245.76923076923077, 246.0, 246.23076923076925, 246.46153846153848, 246.6923076923077, 246.92307692307693, 247.15384615384616, 247.3846153846154, 247.61538461538464, 247.84615384615387, 248.0769230769231, 248.30769230769232, 248.53846153846155, 248.76923076923077, 249.0, 249.23076923076925, 249.46153846153848, 249.6923076923077, 249.92307692307693, 250.15384615384616, 250.3846153846154, 250.61538461538464, 250.84615384615387, 251.0769230769231, 251.30769230769232, 251.53846153846155, 251.76923076923077, 252.0, 252.23076923076925, 252.46153846153848, 252.6923076923077, 252.92307692307693, 253.15384615384616, 253.3846153846154, 253.61538461538464, 253.84615384615387, 254.0769230769231, 254.30769230769232, 254.53846153846155, 254.76923076923077, 255.0, 255.23076923076925, 255.46153846153848, 255.6923076923077, 255.92307692307693, 256.1538461538462, 256.3846153846154, 256.61538461538464, 256.84615384615387, 257.0769230769231, 257.3076923076923, 257.53846153846155, 257.7692307692308, 258.0, 258.2307692307692, 258.46153846153845, 258.6923076923077, 258.92307692307696, 259.1538461538462, 259.3846153846154, 259.61538461538464, 259.84615384615387, 260.0769230769231, 260.3076923076923, 260.53846153846155, 260.7692307692308, 261.0, 261.2307692307692, 261.46153846153845, 261.6923076923077, 261.92307692307696, 262.1538461538462, 262.3846153846154, 262.61538461538464, 262.84615384615387, 263.0769230769231, 263.3076923076923, 263.53846153846155, 263.7692307692308, 264.0, 264.2307692307692, 264.46153846153845, 264.6923076923077, 264.92307692307696, 265.1538461538462, 265.3846153846154, 265.61538461538464, 265.84615384615387, 266.0769230769231, 266.3076923076923, 266.53846153846155, 266.7692307692308, 267.0, 267.2307692307692, 267.46153846153845, 267.6923076923077, 267.92307692307696, 268.1538461538462, 268.3846153846154, 268.61538461538464, 268.84615384615387, 269.0769230769231, 269.3076923076923, 269.53846153846155, 269.7692307692308, 270.0, 270.2307692307692, 270.46153846153845, 270.6923076923077, 270.92307692307696, 271.1538461538462, 271.3846153846154, 271.61538461538464, 271.84615384615387, 272.0769230769231, 272.3076923076923, 272.53846153846155, 272.7692307692308, 273.0, 273.2307692307692, 273.46153846153845, 273.6923076923077, 273.92307692307696, 274.1538461538462, 274.3846153846154, 274.61538461538464, 274.84615384615387, 275.0769230769231, 275.3076923076923, 275.53846153846155, 275.7692307692308, 276.0, 276.2307692307692, 276.46153846153845, 276.69230769230774, 276.92307692307696, 277.1538461538462, 277.3846153846154, 277.61538461538464, 277.84615384615387, 278.0769230769231, 278.3076923076923, 278.53846153846155, 278.7692307692308, 279.0, 279.2307692307692, 279.46153846153845, 279.69230769230774, 279.92307692307696, 280.1538461538462, 280.3846153846154, 280.61538461538464, 280.84615384615387, 281.0769230769231, 281.3076923076923, 281.53846153846155, 281.7692307692308, 282.0, 282.2307692307692, 282.46153846153845, 282.69230769230774, 282.92307692307696, 283.1538461538462, 283.3846153846154, 283.61538461538464, 283.84615384615387, 284.0769230769231, 284.3076923076923, 284.53846153846155, 284.7692307692308, 285.0, 285.2307692307692, 285.46153846153845, 285.69230769230774, 285.92307692307696, 286.1538461538462, 286.3846153846154, 286.61538461538464, 286.84615384615387, 287.0769230769231, 287.3076923076923, 287.53846153846155, 287.7692307692308, 288.0, 288.2307692307692, 288.46153846153845, 288.69230769230774, 288.92307692307696, 289.1538461538462, 289.3846153846154, 289.61538461538464, 289.84615384615387, 290.0769230769231, 290.3076923076923, 290.53846153846155, 290.7692307692308, 291.0, 291.2307692307692, 291.46153846153845, 291.69230769230774, 291.92307692307696, 292.1538461538462, 292.3846153846154, 292.61538461538464, 292.84615384615387, 293.0769230769231, 293.3076923076923, 293.53846153846155, 293.7692307692308, 294.0, 294.2307692307692, 294.46153846153845, 294.69230769230774, 294.92307692307696, 295.1538461538462, 295.3846153846154, 295.61538461538464, 295.84615384615387, 296.0769230769231, 296.3076923076923, 296.53846153846155, 296.7692307692308};
 // Thông số của hệ PID x y theta
 float Output_PID_K_0;
// Các thông số để tính toán động h�?c
 struct Kinematic
 {
	 float X_real, Y_real; // Vị trí robot hiện tại
	 float X_dot, Y_dot;  // Tốc độ theo phương X vs Y của robot hiện tại
	 float V_real, V_Set, V_Set_1;  // Vận tốc hiện tại vs đặt mong muốn của robot
	 float W_Real, W_Set; // Tốc độ quay của robot
	 float Theta_Real_Robot;  //Góc hiện tại của Robot so với trục hoành
	 float WR_Set, WR_Real, WL_Set, WL_Real;  // Tốc độ quay bánh trái và bánh phải
	 float VR_Set, VR_Real, VL_Set, VL_Real; // Tốc độ dài của bánh trái và bánh phải
	 float X_real_mm, Y_real_mm;
	 float X_Welding, Y_Welding, X_Welding_mm, Y_Welding_mm;

 }Kine;

// Thông số của xe
 struct Para_Mobile_Robot
 {
	 float R; // Bán kính bánh xe
	 float L;  // Khoảng cách 2 bánh xe
	 float Distance_X_tourch; // Khoảng cách cần hàn theo phương x của xe
	 float Distance_Y_tourch; // Khoảng cách cần hàn theo phương y của xe
 }Robot;

 struct Para_Motor Para_MR;
 struct Para_Motor Para_ML;
 struct Para_Motor* pt_Para_MR = &Para_MR;
 struct Para_Motor* pt_Para_ML = &Para_ML;
 struct Para_Mobile_Robot* pt_Robot = &Robot;
 struct Kinematic* pt_Kine = &Kine;

 struct PID_XY PID_Theta;
 struct PID_XY PID_Posision;
 struct Possision_Input Pos_1;
 struct PID_XY* pt_PID_theta = &PID_Theta;
 struct PID_XY* pt_PID_posision = &PID_Posision;
 struct Possision_Input* pt_pos_1 = &Pos_1;

 /*****************************************************/
/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_TIM2_Init(void);
static void MX_TIM3_Init(void);
static void MX_TIM4_Init(void);
static void MX_I2C1_Init(void);
static void MX_I2C2_Init(void);
static void MX_SPI1_Init(void);
static void MX_TIM1_Init(void);
static void MX_TIM5_Init(void);
static void MX_USART1_UART_Init(void);
static void MX_USART2_UART_Init(void);
static void MX_TIM8_Init(void);
static void MX_TIM9_Init(void);
static void MX_TIM6_Init(void);
static void MX_TIM10_Init(void);
static void MX_TIM11_Init(void);
/* USER CODE BEGIN PFP */

/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */

/* USER CODE END 0 */

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{
  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */

  /* MCU Configuration--------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */
  pt_Para_MR->Kb = 900;
  pt_Para_MR->Kp = 0.0671641791;
  pt_Para_MR->Ki = 300;
  pt_Para_MR->Kd = 0;

  pt_Para_MR->Ui_1 = 0;
  pt_Para_MR->Ud_1 = 0;

  pt_Para_MR->HIGH = 999;
  pt_Para_MR->LOW = 0;

  pt_Para_ML->Kb = 900;
  pt_Para_ML->Kp = 0.0671641791;
  pt_Para_ML->Ki = 300;
  pt_Para_ML->Kd = 0;

  pt_Para_ML->Ui_1 = 0;
  pt_Para_ML->Ud_1 = 0;

  pt_Para_ML->HIGH = 999;
  pt_Para_ML->LOW = 0;

//  pt_Para_MR->SP_Rad_s = 1.5;
//  pt_Para_ML->SP_Rad_s = 1.5;
/* USER CODE END SysInit */
  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_TIM2_Init();
  MX_TIM3_Init();
  MX_TIM4_Init();
  MX_I2C1_Init();
  MX_I2C2_Init();
  MX_SPI1_Init();
  MX_TIM1_Init();
  MX_TIM5_Init();
  MX_USART1_UART_Init();
  MX_USART2_UART_Init();
  MX_TIM8_Init();
  MX_TIM9_Init();
  MX_TIM6_Init();
  MX_TIM10_Init();
  MX_TIM11_Init();
  /* USER CODE BEGIN 2 */
  void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim);
  void Initial_Mobile_Robot(struct Para_Mobile_Robot* Ro);
  void Initial_PID_XY(struct PID_XY* Pos, struct PID_XY* Theta);
  void Inverse_Right_Motor(int DIR);
  void Inverse_Left_Motor(int DIR);
  void Output_K_PID(struct Kinematic* Kine, struct Para_Mobile_Robot* Ro, struct Para_Motor* MR, struct Para_Motor* ML, struct PID_XY* Pos, struct PID_XY* Anguler);
  void Forward_Kinematic(struct Kinematic* pt_Kine, struct Para_Mobile_Robot* pt_Robot, struct Para_Motor* pt_Para_MR, struct Para_Motor* pt_Para_ML);
  void UART_1(float a1, float a2, float a3, float a4, float a5, float a6);
  float FC_1(float x);
  void Path_planing(float Tap_diem_x[], float Tap_diem_y[], float Mang_Robot[2][2], struct Possision_Input* pos, struct Kinematic* Kine, uint32_t Vi_tri);
  float Tam_xuat(float Da_thuc[2][2]);
  void Stepper(float Khoang_cach_mm);
  void DIR_Servo(int8_t DIR);
  void HAL_TIM_PWM_PulseFinishedCallback(TIM_HandleTypeDef *htim);
  void HAL_I2C_SlaveRxCpltCallback(I2C_HandleTypeDef *hi2c);
  void HAL_I2C_AddrCallback(I2C_HandleTypeDef*hi2c,uint8_t TransferDirection,uint16_t AddrMatchCode);



//  uint16_t Size = sizeof(AX)/sizeof(float);
//  for(int i = 0; i<Size; i++)
//  {
//	  AX[i] = AX[i]*1000;
//	  AY[i] = AY[i]*1000;
//  }

  // Khởi tạo
  Initial_Mobile_Robot(pt_Robot);
  Initial_PID_XY(pt_PID_posision, pt_PID_theta);
  pt_Kine->V_Set = 0.05;
  pt_Kine->Theta_Real_Robot = 1.57;

  HAL_I2C_SlaveRxCpltCallback(&hi2c1);
  HAL_TIM_Base_Start_IT(&htim8);  // Timer cho PID DC Motor
  HAL_TIM_Base_Start_IT(&htim6); // Timer Global
  HAL_TIM_Base_Start_IT(&htim10); // Timer Stepper
  HAL_TIM_Base_Start_IT(&htim11); // Timer Init

  HAL_TIM_Encoder_Start_IT(&htim3, TIM_CHANNEL_1 && TIM_CHANNEL_2);
  HAL_TIM_Encoder_Start_IT(&htim4, TIM_CHANNEL_1 && TIM_CHANNEL_2);

  HAL_TIM_PWM_Start_IT(&htim5, TIM_CHANNEL_1);

  HAL_TIM_PWM_Start(&htim2, TIM_CHANNEL_1);
  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1);

//  pt_Para_MR->SP_Rad_s = 1.5;
//    pt_Para_ML->SP_Rad_s = 1.5;
//  Inverse_Right_Motor(0);
//  Inverse_Left_Motor(0);


  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */



	  OUT_01[1] = -1*o1;
	  OUT_01[3] = o1;
	     // Xuất xung PWM PID
//	     __HAL_TIM_SET_COMPARE(&htim2, TIM_CHANNEL_1, pt_Para_MR->Out_PWM);
//	     __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, pt_Para_ML->Out_PWM);
//	  Size_Data = sizeof(Data_001);
//	  HAL_UART_Transmit(&huart2, Data_001, Size_Data, 100);
	  EX = pt_pos_1->x - pt_Kine->X_real;
	  EY = pt_pos_1->y - pt_Kine->Y_real;
	  E_Velocity = pt_Kine->V_Set - pt_Kine->V_real;
	  Error_Distance = sqrt(pow(EX,2) + pow(EX,2));
	  //UART_1(pt_Kine->V_Set, pt_Kine->V_real,pt_pos_1->x, pt_pos_1->y, pt_Kine->X_Welding, pt_Kine->Y_Welding);
	  UART_1(Mang_Robot_1[0][0], Mang_Robot_1[0][1], pt_pos_1->x, pt_pos_1->y , pt_Kine->X_Welding, pt_Kine->Y_Welding);
	  //UART_1(EX, EY, EV);

	  //Stepper(Khoang_cach_mm_1);

//	  // Oled
//		ssd1306_Fill(Black);
//		a_float = 3.0;
//		// Format Oled
//		sprintf(str10, "%.2f", a_float);
//		ssd1306_SetCursor(25, 0);
//		ssd1306_WriteString("Do an Co Dien Tu", Font_7x10, White);
//		ssd1306_Line(25, 10, ax1, ay1, White);
//		// Toa do X
//		ssd1306_SetCursor(0, 20);
//		ssd1306_WriteString("X: ", Font_6x8, White);
//		ssd1306_SetCursor(6*3, 20);
//		ssd1306_WriteString(str10, Font_6x8, White);
//		// Toa do Y
//		ssd1306_SetCursor(0, 28);
//		ssd1306_WriteString("Y: ", Font_6x8, White);
//		ssd1306_SetCursor(6*3, 28);
//		ssd1306_WriteString(str10, Font_6x8, White);
//		// Goc Theta
//		ssd1306_SetCursor(0, 36);
//		ssd1306_WriteString("Theta: ", Font_6x8, White);
//		ssd1306_SetCursor(6*7, 36);
//		ssd1306_WriteString(str10, Font_6x8, White);
//		ssd1306_UpdateScreen();


	  HAL_Delay(50);

  }
  /* USER CODE END 3 */
}

/**
  * @brief System Clock Configuration
  * @retval None
  */
void SystemClock_Config(void)
{
  RCC_OscInitTypeDef RCC_OscInitStruct = {0};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};

  /** Configure the main internal regulator output voltage
  */
  __HAL_RCC_PWR_CLK_ENABLE();
  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);

  /** Initializes the RCC Oscillators according to the specified parameters
  * in the RCC_OscInitTypeDef structure.
  */
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSE;
  RCC_OscInitStruct.HSEState = RCC_HSE_ON;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;
  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSE;
  RCC_OscInitStruct.PLL.PLLM = 4;
  RCC_OscInitStruct.PLL.PLLN = 144;
  RCC_OscInitStruct.PLL.PLLP = RCC_PLLP_DIV2;
  RCC_OscInitStruct.PLL.PLLQ = 4;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }

  /** Initializes the CPU, AHB and APB buses clocks
  */
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV4;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV2;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_4) != HAL_OK)
  {
    Error_Handler();
  }
}

/**
  * @brief I2C1 Initialization Function
  * @param None
  * @retval None
  */
static void MX_I2C1_Init(void)
{

  /* USER CODE BEGIN I2C1_Init 0 */

  /* USER CODE END I2C1_Init 0 */

  /* USER CODE BEGIN I2C1_Init 1 */

  /* USER CODE END I2C1_Init 1 */
  hi2c1.Instance = I2C1;
  hi2c1.Init.ClockSpeed = 400000;
  hi2c1.Init.DutyCycle = I2C_DUTYCYCLE_2;
  hi2c1.Init.OwnAddress1 = 36;
  hi2c1.Init.AddressingMode = I2C_ADDRESSINGMODE_7BIT;
  hi2c1.Init.DualAddressMode = I2C_DUALADDRESS_DISABLE;
  hi2c1.Init.OwnAddress2 = 0;
  hi2c1.Init.GeneralCallMode = I2C_GENERALCALL_DISABLE;
  hi2c1.Init.NoStretchMode = I2C_NOSTRETCH_DISABLE;
  if (HAL_I2C_Init(&hi2c1) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN I2C1_Init 2 */

  /* USER CODE END I2C1_Init 2 */

}

/**
  * @brief I2C2 Initialization Function
  * @param None
  * @retval None
  */
static void MX_I2C2_Init(void)
{

  /* USER CODE BEGIN I2C2_Init 0 */

  /* USER CODE END I2C2_Init 0 */

  /* USER CODE BEGIN I2C2_Init 1 */

  /* USER CODE END I2C2_Init 1 */
  hi2c2.Instance = I2C2;
  hi2c2.Init.ClockSpeed = 100000;
  hi2c2.Init.DutyCycle = I2C_DUTYCYCLE_2;
  hi2c2.Init.OwnAddress1 = 0;
  hi2c2.Init.AddressingMode = I2C_ADDRESSINGMODE_7BIT;
  hi2c2.Init.DualAddressMode = I2C_DUALADDRESS_DISABLE;
  hi2c2.Init.OwnAddress2 = 0;
  hi2c2.Init.GeneralCallMode = I2C_GENERALCALL_DISABLE;
  hi2c2.Init.NoStretchMode = I2C_NOSTRETCH_DISABLE;
  if (HAL_I2C_Init(&hi2c2) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN I2C2_Init 2 */

  /* USER CODE END I2C2_Init 2 */

}

/**
  * @brief SPI1 Initialization Function
  * @param None
  * @retval None
  */
static void MX_SPI1_Init(void)
{

  /* USER CODE BEGIN SPI1_Init 0 */

  /* USER CODE END SPI1_Init 0 */

  /* USER CODE BEGIN SPI1_Init 1 */

  /* USER CODE END SPI1_Init 1 */
  /* SPI1 parameter configuration*/
  hspi1.Instance = SPI1;
  hspi1.Init.Mode = SPI_MODE_MASTER;
  hspi1.Init.Direction = SPI_DIRECTION_2LINES;
  hspi1.Init.DataSize = SPI_DATASIZE_8BIT;
  hspi1.Init.CLKPolarity = SPI_POLARITY_LOW;
  hspi1.Init.CLKPhase = SPI_PHASE_1EDGE;
  hspi1.Init.NSS = SPI_NSS_SOFT;
  hspi1.Init.BaudRatePrescaler = SPI_BAUDRATEPRESCALER_2;
  hspi1.Init.FirstBit = SPI_FIRSTBIT_MSB;
  hspi1.Init.TIMode = SPI_TIMODE_DISABLE;
  hspi1.Init.CRCCalculation = SPI_CRCCALCULATION_DISABLE;
  hspi1.Init.CRCPolynomial = 10;
  if (HAL_SPI_Init(&hspi1) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN SPI1_Init 2 */

  /* USER CODE END SPI1_Init 2 */

}

/**
  * @brief TIM1 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM1_Init(void)
{

  /* USER CODE BEGIN TIM1_Init 0 */

  /* USER CODE END TIM1_Init 0 */

  TIM_MasterConfigTypeDef sMasterConfig = {0};
  TIM_OC_InitTypeDef sConfigOC = {0};
  TIM_BreakDeadTimeConfigTypeDef sBreakDeadTimeConfig = {0};

  /* USER CODE BEGIN TIM1_Init 1 */

  /* USER CODE END TIM1_Init 1 */
  htim1.Instance = TIM1;
  htim1.Init.Prescaler = 6;
  htim1.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim1.Init.Period = 999;
  htim1.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim1.Init.RepetitionCounter = 0;
  htim1.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_PWM_Init(&htim1) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim1, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sConfigOC.OCMode = TIM_OCMODE_PWM1;
  sConfigOC.Pulse = 0;
  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;
  sConfigOC.OCNPolarity = TIM_OCNPOLARITY_HIGH;
  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
  sConfigOC.OCIdleState = TIM_OCIDLESTATE_RESET;
  sConfigOC.OCNIdleState = TIM_OCNIDLESTATE_RESET;
  if (HAL_TIM_PWM_ConfigChannel(&htim1, &sConfigOC, TIM_CHANNEL_1) != HAL_OK)
  {
    Error_Handler();
  }
  sBreakDeadTimeConfig.OffStateRunMode = TIM_OSSR_DISABLE;
  sBreakDeadTimeConfig.OffStateIDLEMode = TIM_OSSI_DISABLE;
  sBreakDeadTimeConfig.LockLevel = TIM_LOCKLEVEL_OFF;
  sBreakDeadTimeConfig.DeadTime = 0;
  sBreakDeadTimeConfig.BreakState = TIM_BREAK_DISABLE;
  sBreakDeadTimeConfig.BreakPolarity = TIM_BREAKPOLARITY_HIGH;
  sBreakDeadTimeConfig.AutomaticOutput = TIM_AUTOMATICOUTPUT_DISABLE;
  if (HAL_TIMEx_ConfigBreakDeadTime(&htim1, &sBreakDeadTimeConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM1_Init 2 */

  /* USER CODE END TIM1_Init 2 */
  HAL_TIM_MspPostInit(&htim1);

}

/**
  * @brief TIM2 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM2_Init(void)
{

  /* USER CODE BEGIN TIM2_Init 0 */

  /* USER CODE END TIM2_Init 0 */

  TIM_MasterConfigTypeDef sMasterConfig = {0};
  TIM_OC_InitTypeDef sConfigOC = {0};

  /* USER CODE BEGIN TIM2_Init 1 */

  /* USER CODE END TIM2_Init 1 */
  htim2.Instance = TIM2;
  htim2.Init.Prescaler = 6;
  htim2.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim2.Init.Period = 999;
  htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_PWM_Init(&htim2) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim2, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sConfigOC.OCMode = TIM_OCMODE_PWM1;
  sConfigOC.Pulse = 0;
  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;
  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
  if (HAL_TIM_PWM_ConfigChannel(&htim2, &sConfigOC, TIM_CHANNEL_1) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM2_Init 2 */

  /* USER CODE END TIM2_Init 2 */
  HAL_TIM_MspPostInit(&htim2);

}

/**
  * @brief TIM3 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM3_Init(void)
{

  /* USER CODE BEGIN TIM3_Init 0 */

  /* USER CODE END TIM3_Init 0 */

  TIM_Encoder_InitTypeDef sConfig = {0};
  TIM_MasterConfigTypeDef sMasterConfig = {0};

  /* USER CODE BEGIN TIM3_Init 1 */

  /* USER CODE END TIM3_Init 1 */
  htim3.Instance = TIM3;
  htim3.Init.Prescaler = 0;
  htim3.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim3.Init.Period = 65535;
  htim3.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim3.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  sConfig.EncoderMode = TIM_ENCODERMODE_TI12;
  sConfig.IC1Polarity = TIM_ICPOLARITY_RISING;
  sConfig.IC1Selection = TIM_ICSELECTION_DIRECTTI;
  sConfig.IC1Prescaler = TIM_ICPSC_DIV1;
  sConfig.IC1Filter = 0;
  sConfig.IC2Polarity = TIM_ICPOLARITY_RISING;
  sConfig.IC2Selection = TIM_ICSELECTION_DIRECTTI;
  sConfig.IC2Prescaler = TIM_ICPSC_DIV1;
  sConfig.IC2Filter = 0;
  if (HAL_TIM_Encoder_Init(&htim3, &sConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim3, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM3_Init 2 */

  /* USER CODE END TIM3_Init 2 */

}

/**
  * @brief TIM4 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM4_Init(void)
{

  /* USER CODE BEGIN TIM4_Init 0 */

  /* USER CODE END TIM4_Init 0 */

  TIM_Encoder_InitTypeDef sConfig = {0};
  TIM_MasterConfigTypeDef sMasterConfig = {0};

  /* USER CODE BEGIN TIM4_Init 1 */

  /* USER CODE END TIM4_Init 1 */
  htim4.Instance = TIM4;
  htim4.Init.Prescaler = 0;
  htim4.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim4.Init.Period = 65535;
  htim4.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim4.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  sConfig.EncoderMode = TIM_ENCODERMODE_TI12;
  sConfig.IC1Polarity = TIM_ICPOLARITY_RISING;
  sConfig.IC1Selection = TIM_ICSELECTION_DIRECTTI;
  sConfig.IC1Prescaler = TIM_ICPSC_DIV1;
  sConfig.IC1Filter = 0;
  sConfig.IC2Polarity = TIM_ICPOLARITY_RISING;
  sConfig.IC2Selection = TIM_ICSELECTION_DIRECTTI;
  sConfig.IC2Prescaler = TIM_ICPSC_DIV1;
  sConfig.IC2Filter = 0;
  if (HAL_TIM_Encoder_Init(&htim4, &sConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim4, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM4_Init 2 */

  /* USER CODE END TIM4_Init 2 */

}

/**
  * @brief TIM5 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM5_Init(void)
{

  /* USER CODE BEGIN TIM5_Init 0 */

  /* USER CODE END TIM5_Init 0 */

  TIM_MasterConfigTypeDef sMasterConfig = {0};
  TIM_OC_InitTypeDef sConfigOC = {0};

  /* USER CODE BEGIN TIM5_Init 1 */

  /* USER CODE END TIM5_Init 1 */
  htim5.Instance = TIM5;
  htim5.Init.Prescaler = 2057;
  htim5.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim5.Init.Period = 99;
  htim5.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim5.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_PWM_Init(&htim5) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim5, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sConfigOC.OCMode = TIM_OCMODE_PWM1;
  sConfigOC.Pulse = 0;
  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;
  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
  if (HAL_TIM_PWM_ConfigChannel(&htim5, &sConfigOC, TIM_CHANNEL_1) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM5_Init 2 */

  /* USER CODE END TIM5_Init 2 */
  HAL_TIM_MspPostInit(&htim5);

}

/**
  * @brief TIM6 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM6_Init(void)
{

  /* USER CODE BEGIN TIM6_Init 0 */

  /* USER CODE END TIM6_Init 0 */

  TIM_MasterConfigTypeDef sMasterConfig = {0};

  /* USER CODE BEGIN TIM6_Init 1 */

  /* USER CODE END TIM6_Init 1 */
  htim6.Instance = TIM6;
  htim6.Init.Prescaler = 1439;
  htim6.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim6.Init.Period = 4999;
  htim6.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim6) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim6, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM6_Init 2 */

  /* USER CODE END TIM6_Init 2 */

}

/**
  * @brief TIM8 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM8_Init(void)
{

  /* USER CODE BEGIN TIM8_Init 0 */

  /* USER CODE END TIM8_Init 0 */

  TIM_ClockConfigTypeDef sClockSourceConfig = {0};
  TIM_MasterConfigTypeDef sMasterConfig = {0};

  /* USER CODE BEGIN TIM8_Init 1 */

  /* USER CODE END TIM8_Init 1 */
  htim8.Instance = TIM8;
  htim8.Init.Prescaler = 1439;
  htim8.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim8.Init.Period = 499;
  htim8.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim8.Init.RepetitionCounter = 0;
  htim8.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim8) != HAL_OK)
  {
    Error_Handler();
  }
  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;
  if (HAL_TIM_ConfigClockSource(&htim8, &sClockSourceConfig) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim8, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM8_Init 2 */

  /* USER CODE END TIM8_Init 2 */

}

/**
  * @brief TIM9 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM9_Init(void)
{

  /* USER CODE BEGIN TIM9_Init 0 */

  /* USER CODE END TIM9_Init 0 */

  TIM_ClockConfigTypeDef sClockSourceConfig = {0};

  /* USER CODE BEGIN TIM9_Init 1 */

  /* USER CODE END TIM9_Init 1 */
  htim9.Instance = TIM9;
  htim9.Init.Prescaler = 0;
  htim9.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim9.Init.Period = 65535;
  htim9.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim9.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim9) != HAL_OK)
  {
    Error_Handler();
  }
  sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;
  if (HAL_TIM_ConfigClockSource(&htim9, &sClockSourceConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM9_Init 2 */

  /* USER CODE END TIM9_Init 2 */

}

/**
  * @brief TIM10 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM10_Init(void)
{

  /* USER CODE BEGIN TIM10_Init 0 */

  /* USER CODE END TIM10_Init 0 */

  /* USER CODE BEGIN TIM10_Init 1 */

  /* USER CODE END TIM10_Init 1 */
  htim10.Instance = TIM10;
  htim10.Init.Prescaler = 1439;
  htim10.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim10.Init.Period = 19999;
  htim10.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim10.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim10) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM10_Init 2 */

  /* USER CODE END TIM10_Init 2 */

}

/**
  * @brief TIM11 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM11_Init(void)
{

  /* USER CODE BEGIN TIM11_Init 0 */

  /* USER CODE END TIM11_Init 0 */

  /* USER CODE BEGIN TIM11_Init 1 */

  /* USER CODE END TIM11_Init 1 */
  htim11.Instance = TIM11;
  htim11.Init.Prescaler = 1440;
  htim11.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim11.Init.Period = 999;
  htim11.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim11.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim11) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM11_Init 2 */

  /* USER CODE END TIM11_Init 2 */

}

/**
  * @brief USART1 Initialization Function
  * @param None
  * @retval None
  */
static void MX_USART1_UART_Init(void)
{

  /* USER CODE BEGIN USART1_Init 0 */

  /* USER CODE END USART1_Init 0 */

  /* USER CODE BEGIN USART1_Init 1 */

  /* USER CODE END USART1_Init 1 */
  huart1.Instance = USART1;
  huart1.Init.BaudRate = 9600;
  huart1.Init.WordLength = UART_WORDLENGTH_8B;
  huart1.Init.StopBits = UART_STOPBITS_1;
  huart1.Init.Parity = UART_PARITY_NONE;
  huart1.Init.Mode = UART_MODE_TX_RX;
  huart1.Init.HwFlowCtl = UART_HWCONTROL_NONE;
  huart1.Init.OverSampling = UART_OVERSAMPLING_16;
  if (HAL_UART_Init(&huart1) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN USART1_Init 2 */

  /* USER CODE END USART1_Init 2 */

}

/**
  * @brief USART2 Initialization Function
  * @param None
  * @retval None
  */
static void MX_USART2_UART_Init(void)
{

  /* USER CODE BEGIN USART2_Init 0 */

  /* USER CODE END USART2_Init 0 */

  /* USER CODE BEGIN USART2_Init 1 */

  /* USER CODE END USART2_Init 1 */
  huart2.Instance = USART2;
  huart2.Init.BaudRate = 9600;
  huart2.Init.WordLength = UART_WORDLENGTH_8B;
  huart2.Init.StopBits = UART_STOPBITS_1;
  huart2.Init.Parity = UART_PARITY_NONE;
  huart2.Init.Mode = UART_MODE_TX_RX;
  huart2.Init.HwFlowCtl = UART_HWCONTROL_NONE;
  huart2.Init.OverSampling = UART_OVERSAMPLING_16;
  if (HAL_UART_Init(&huart2) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN USART2_Init 2 */

  /* USER CODE END USART2_Init 2 */

}

/**
  * @brief GPIO Initialization Function
  * @param None
  * @retval None
  */
static void MX_GPIO_Init(void)
{
  GPIO_InitTypeDef GPIO_InitStruct = {0};
/* USER CODE BEGIN MX_GPIO_Init_1 */
/* USER CODE END MX_GPIO_Init_1 */

  /* GPIO Ports Clock Enable */
  __HAL_RCC_GPIOE_CLK_ENABLE();
  __HAL_RCC_GPIOH_CLK_ENABLE();
  __HAL_RCC_GPIOC_CLK_ENABLE();
  __HAL_RCC_GPIOA_CLK_ENABLE();
  __HAL_RCC_GPIOB_CLK_ENABLE();
  __HAL_RCC_GPIOD_CLK_ENABLE();

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(GPIOE, RUN_LIGHT_Pin|STOP_LIGHT_Pin|WARNING_LIGHT_Pin|GPIO_PIN_15, GPIO_PIN_RESET);

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0|GPIO_PIN_1|GPIO_PIN_2|GPIO_PIN_3, GPIO_PIN_RESET);

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(GPIOD, DIR_L_Pin|DIR_R_Pin|DIR_SERVO_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pins : RUN_LIGHT_Pin STOP_LIGHT_Pin WARNING_LIGHT_Pin */
  GPIO_InitStruct.Pin = RUN_LIGHT_Pin|STOP_LIGHT_Pin|WARNING_LIGHT_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOE, &GPIO_InitStruct);

  /*Configure GPIO pins : PC0 PC1 PC2 PC3 */
  GPIO_InitStruct.Pin = GPIO_PIN_0|GPIO_PIN_1|GPIO_PIN_2|GPIO_PIN_3;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);

  /*Configure GPIO pin : PE15 */
  GPIO_InitStruct.Pin = GPIO_PIN_15;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_VERY_HIGH;
  HAL_GPIO_Init(GPIOE, &GPIO_InitStruct);

  /*Configure GPIO pins : USER_BUTTON_Pin STOP_Button_Pin START_Button_Pin */
  GPIO_InitStruct.Pin = USER_BUTTON_Pin|STOP_Button_Pin|START_Button_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_INPUT;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  HAL_GPIO_Init(GPIOD, &GPIO_InitStruct);

  /*Configure GPIO pins : DIR_L_Pin DIR_R_Pin DIR_SERVO_Pin */
  GPIO_InitStruct.Pin = DIR_L_Pin|DIR_R_Pin|DIR_SERVO_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOD, &GPIO_InitStruct);

/* USER CODE BEGIN MX_GPIO_Init_2 */
/* USER CODE END MX_GPIO_Init_2 */
}

/* USER CODE BEGIN 4 */
// Stepper
void DIR_Servo(int8_t DIR)
{
	if(DIR == 1)
	{
		HAL_GPIO_WritePin(GPIOD, GPIO_PIN_7, SET);
	}
	else if(DIR == -1)
	{
		HAL_GPIO_WritePin(GPIOD, GPIO_PIN_7, RESET);
	}

}

// Ham_dem_xung_Serrvo
void HAL_TIM_PWM_PulseFinishedCallback(TIM_HandleTypeDef *htim)
{
	if(htim->Instance == TIM5)
	{
		if(Counter_AC == Diem_dung)
		{
			__HAL_TIM_SET_COMPARE(&htim5, TIM_CHANNEL_1, 0);
		}
		else if(Counter_AC < Diem_dung)
		{
			DIR = 1;
			DIR_Servo(DIR);
			__HAL_TIM_SET_COMPARE(&htim5, TIM_CHANNEL_1, 49);
			Counter_AC+=1;
		}
		else if(Counter_AC > Diem_dung)
		{
			DIR = -1;
			__HAL_TIM_SET_COMPARE(&htim5, TIM_CHANNEL_1, 49);
			DIR_Servo(DIR);
			Counter_AC-=1;
		}
	}
}

void Stepper(float Khoang_cach_mm)
{
	float phan_giai = 1;
	float Buoc_ren = 4;  // Bước 4
	Diem_dung = (int32_t)(Khoang_cach_mm*200*phan_giai)/(Buoc_ren);
}
// Duy Nhat
void UART_1(float a1, float a2, float a3, float a4, float a5, float a6)
{
    //a1 = sin(t) + t ;
    // Giới hạn giá trị chỉ với 4 chữ số sau dấu chấm thập phân
    int integer_part1 = (int)a1;
    float decimal_part1 = a1 - integer_part1; // Lấy phần thập phân
    decimal_part1 *= 10000000; // Dịch chuyển phần thập phân sang trái 4 chữ số
    int truncated_decimal1 = (int)decimal_part1; // Chuyển phần thập phân đã dịch chuyển thành số nguyên
     b1 = integer_part1 + truncated_decimal1 / 10000000.0; // Kết hợp lại phần nguyên và phần thập phân đã cắt


     //a2 = 10 + sin(t) + t ;
     int integer_part2 = (int)a2;
     float decimal_part2 = a2 - integer_part2;
     decimal_part2 *= 10000000;
     int truncated_decimal2 = (int)decimal_part2;
      b2 = integer_part2 + truncated_decimal2 / 10000000.0;

     //a3 =10 + sin(t) + t + a ;
     int integer_part3 = (int)a3;
     float decimal_part3 = a3 - integer_part3;
     decimal_part3 *= 10000000;
     int truncated_decimal3 = (int)decimal_part3;
     b3 = integer_part3 + truncated_decimal3 / 10000000.0;

     //a4 =  sin(t) + t ;
     int integer_part4 = (int)a4;
     float decimal_part4 = a4 - integer_part4;
     decimal_part4 *= 10000000;
     int truncated_decimal4 = (int)decimal_part4;
     b4 = integer_part4 + truncated_decimal4 / 10000000.0;



     int integer_part5 = (int)a5;
     float decimal_part5 = a5 - integer_part5;
     decimal_part5 *= 10000000;
     int truncated_decimal5 = (int)decimal_part5;
     b5 = integer_part5 + truncated_decimal5 / 10000000.0;
     //b5 = c1;


     int integer_part6 = (int)a6;
     float decimal_part6 = a6 - integer_part6;
     decimal_part6 *= 10000000;
     int truncated_decimal6 = (int)decimal_part6;
     b6 = integer_part6 + truncated_decimal6 / 10000000.0;
     //b6 = c2;



    //�?ếm size của mảng trước khi gán
	 sprintf(str1, "%.7f", b1);
	 sprintf(str2, "%.7f", b2);
	 int length1 = strlen(str1);
	 int length2 = strlen(str2);

	 sprintf(str3, "%.7f", b3);
	 sprintf(str4, "%.7f", b4);
	 int length3 = strlen(str3);
	 int length4 = strlen(str4);

	 sprintf(str5, "%.7f", b5);
	 sprintf(str6, "%.7f", b6);
	 int length5 = strlen(str5);
	 int length6 = strlen(str6);

	 // lấy length vừa tính được định dạng cho chuỗi
	 char str_a1[length1], str_a2[length2];
	 sprintf(str_a1, "%.7f", b1);
	 sprintf(str_a2, "%.7f", b2);

	 char str_a3[length3], str_a4[length4];
	 sprintf(str_a3, "%.7f", b3);
	 sprintf(str_a4, "%.7f", b4);

	 char str_a5[length5], str_a6[length6];
	 sprintf(str_a5, "%.7f", b5);
	 sprintf(str_a6, "%.7f", b6);

	 // tính tổng size cho mảng data_out
	 uint16_t size_data_out = sizeof(str_a1) + sizeof(str_a2)  + sizeof(str_a3) + sizeof(str_a4)+ sizeof(str_a5) + sizeof(str_a6) + 6;


	 // ghép lần lượt các chuỗi  vào dataout
	 char data_out[size_data_out];
	 strcpy(data_out, str_a1);
	 strcat(data_out, ";");
	 strcat(data_out, str_a2);
	 strcat(data_out, ";");

	 strcat(data_out, str_a3);
	 strcat(data_out, ";");
	 strcat(data_out, str_a4);
	 strcat(data_out, ";");

	 strcat(data_out, str_a5);
	 strcat(data_out, ";");
	 strcat(data_out, str_a6);
	 strcat(data_out, ";");

	 HAL_UART_Transmit(&huart2, data_out, size_data_out , 1000);

}
// Khởi tạo thông số xe
void Initial_Mobile_Robot(struct Para_Mobile_Robot* Ro)
{
	Ro->L = 0.175; // Khoảng cách 2 bánh xe
	Ro->R = 0.145/2; // Bán kính bánh xe
//	Ro->Distance_X_tourch = 0.15;
//	Ro->Distance_Y_tourch = 0.3;
	Ro->Distance_X_tourch = 0.0;
	Ro->Distance_Y_tourch = 0.2;
}

void Initial_PID_XY(struct PID_XY* Pos, struct PID_XY* Theta)
{
	// PID1
//	// PID vị trí
//	Pos->Kp = 0.85;
//	Pos->Ki = 0.65;
//	Pos->Kd  = 8.0;
//	// PID góc tiếp tuyến
//	Theta->Kp = 0.10;
//	Theta->Ki = 0.0;
//	Theta->Kd = 0.0;

	// PID2
//	// PID vị trí
//	Pos->Kp = 0.85;
//	Pos->Ki = 1.5;
//	Pos->Kd  = 8.0;
//	// PID góc tiếp tuyến
//	Theta->Kp = 1.0;
//	Theta->Ki = 0.5;
//	Theta->Kd = 1.0;

	//PID3
//	// PID vị trí
//	Pos->Kp = 0.85;
//	Pos->Ki = 0.8;
//	Pos->Kd  = 10.0;
//	// PID góc tiếp tuyến
//	Theta->Kp = 1.0;
//	Theta->Ki = 0.8;
//	Theta->Kd = 1.0;

//	// PID vị trí
//	Pos->Kp = 0.85;
//	Pos->Ki = 0.75;
//	Pos->Kd  = 10.0;
//	// PID góc tiếp tuyến
//	Theta->Kp = 0.8;
//	Theta->Ki = 0.4;
//	Theta->Kd = 1.5;

//	// PID vị trí
//	Pos->Kp = 2.5;
//	Pos->Ki = 0.02;
//	Pos->Kd  = 10.0;
//	// PID góc tiếp tuyến
//	Theta->Kp = 1.5;
//	Theta->Ki = 0.02;
//	Theta->Kd = 1.5;

//	// PID vị trí
//	Pos->Kp = 2.5;
//	Pos->Ki = 0.02;
//	Pos->Kd  = 1.5;
//	// PID góc tiếp tuyến
//	Theta->Kp = 1.5;
//	Theta->Ki = 0.02;
//	Theta->Kd = 1.5;

//	// PID vị trí
//	Pos->Kp = 5.5;
//	Pos->Ki = 0.03;
//	Pos->Kd  = 0.89;
//	// PID góc tiếp tuyến
//	Theta->Kp = 1.5;
//	Theta->Ki = 0.00;
//	Theta->Kd = 0.5;

//		// PID vị trí
//		Pos->Kp = 5.5;
//		Pos->Ki = 0.035;
//		Pos->Kd  = 0.985;
//		// PID góc tiếp tuyến
//		Theta->Kp = 1.1;
//		Theta->Ki = 0.00;
//		Theta->Kd = 0.64;

//	// PID vị trí
//	Pos->Kp = 7.5;
//	Pos->Ki = 0.815;
//	Pos->Kd  = 15;
//	// PID góc tiếp tuyến
//	Theta->Kp = 5.5;
//	Theta->Ki = 0.00;
//	Theta->Kd = 1.64;

		// PID vị trí
		Pos->Kp = 1.5;
		Pos->Ki = 0.15;
		Pos->Kd  = 3.5;
		// PID góc tiếp tuyến
		Theta->Kp = 5.5;
		Theta->Ki = 0.00;
		Theta->Kd = 1.64;


	// Can han
//	// PID vị trí
//	Pos->Kp = 7.5;
//	Pos->Ki = 0.585;
//	Pos->Kd  = 15.0;
//	// PID góc tiếp tuyến
//	Theta->Kp = 5.5;
//	Theta->Ki = 0.00;
//	Theta->Kd = 1.64;


	Pos->High_Limit = 200.0;
	Pos->Low_Limit = -200.0;
	Theta->High_Limit = 200.0;
	Theta->Low_Limit = -200.0;
}

// DIR = 0 Forward DIR = 1 Inverse // Tamj th�?i DIR 2 chân
void Inverse_Right_Motor(int DIR)
{
	if(DIR == 0)
	{
		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0, SET);
		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_1, RESET);
	}
	else if(DIR == 1)
	{
		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_0, RESET);
		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_1, SET);
	}
}

void Inverse_Left_Motor(int DIR)
{
	if(DIR == 0)
	{
		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_2, SET);
		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_3, RESET);
	}
	else if(DIR == 1)
	{
		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_2, RESET);
		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_3, SET);
	}
}

void Output_K_PID(struct Kinematic* Kine, struct Para_Mobile_Robot* Ro, struct Para_Motor* MR, struct Para_Motor* ML, struct PID_XY* Pos, struct PID_XY* Anguler)
{
	Output_PID_K_0 = (Pos->Output + Anguler->Output)/2.0;
	Kine->VR_Set =   Output_PID_K_0 * (Ro->L / 2.0)   + Kine->V_Set; // v1 = u1*L/2 + vconst;
	Kine->VL_Set = -(Output_PID_K_0 * (Ro->L / 2.0))  + Kine->V_Set; // v2 = -u1*L/2 + vconst;
	Kine->V_Set_1 = (Kine->VR_Set + Kine->VL_Set)/2.0;  // v = (v1+v2)/2;
	MR->SP_Rad_s = Kine->V_Set_1/Ro->R;  //wr = v1/R;
	ML->SP_Rad_s = Kine->V_Set_1/Ro->R;  // wl = v2/R
}

// �?ộng h�?c thuận
void Forward_Kinematic(struct Kinematic* pt_Kine, struct Para_Mobile_Robot* pt_Robot, struct Para_Motor* pt_Para_MR, struct Para_Motor* pt_Para_ML)
{
	/*v= (WR+WL)*0.065/2;
	w= ((WR-WL)*0.065)/(2*0.17);
	xdot_fn=v*cos(th_er);
	ydot_fn=v*sin(th_er);*/
	pt_Kine->V_real = (pt_Para_MR->Rad_s + pt_Para_ML->Rad_s)*(pt_Robot->R/2); // Tính vận tốc thực tế cho xe
	pt_Kine->W_Real = ((pt_Para_MR->Rad_s - pt_Para_ML->Rad_s)*pt_Robot->R)/(2*pt_Robot->L); // Tốc độ quay của robot hiện tại
	pt_Kine->X_dot = pt_Kine->V_real*cos(pt_Kine->Theta_Real_Robot); // x dot
	pt_Kine->Y_dot = pt_Kine->V_real*sin(pt_Kine->Theta_Real_Robot); // y dot
	// Tích phân để ra x,y hiện tại của robot
	pt_Kine->X_real = pt_Kine->X_real + pt_Kine->X_dot*Time_Interrupt; // Vị trí của robot phương X
	pt_Kine->Y_real = pt_Kine->Y_real + pt_Kine->Y_dot*Time_Interrupt; // Vị trí của robot phương Y


}

/**********************************        Path planing        *******************************/
//Quy dao mau
float FC_1(float x)
{
	float A = 0;
	//A = (5.52*pow(10,-8)*pow(x,4) - 5.456*pow(10,-5)*pow(x,3) + 0.01686*pow(x,2)- 1.783*x + 309.7)*0.5;
	//A = pow(x,2) + x -2;
	//A =2* pow(x,3) + 5*pow(x,2) + x -2;
	//**A = 0.00367052*pow(x,4) + 0.01950814*pow(x,3) - 0.21729992*pow(x,2) - 0.70247411*x + 2.06652717;
	A = 0.0222*pow(x,3) - 0.1001*pow(x,2) - 0.6718*x + 1.8095;

	return A;
}

float Tam_xuat(float Da_thuc[2][2])
{
	float He_so_a = 0;
	He_so_a = (Da_thuc[1][1] - Da_thuc[1][0])/(Da_thuc[0][1] - Da_thuc[0][0]);  // (y2-y1)/(x2-x1)
	return He_so_a;
}

// Quy dao toa do x,y
void Path_planing(float Tap_diem_x[], float Tap_diem_y[], float Mang_Robot[2][2], struct Possision_Input* pos, struct Kinematic* Kine, uint32_t Vi_tri)
{
	while(Kine->Y_Welding >= Mang_Robot[1][1])
	{
		Vi_tri = Vi_tri + 1;
		for(int i=0; i<2;i++)
		{
			// Gan lai toa do moi x,y robot se den vao mang Robot
			Mang_Robot[i][0] = Tap_diem_x[Vi_tri+i];
			Mang_Robot[i][1] = Tap_diem_y[Vi_tri+i];
		}
	}
		// Phuong trinh duong thang //* dang so sanh voi x
		float He_so_a = 0;
		if((Mang_Robot[1][0] - Mang_Robot[0][0]) == 0)
		{
			He_so_a = 1000;
		}
		else
		{
			He_so_a = (Mang_Robot[1][1] - Mang_Robot[0][1])/(Mang_Robot[1][0] - Mang_Robot[0][0]);
		}
		float Temp_Path_1 = Mang_Robot[0][1] - He_so_a*Mang_Robot[0][0]; // b = y1 - ((y2-y1)/(x2-x1))*x1

		pos->x = (Kine->Y_Welding- Temp_Path_1)/He_so_a;


		pos->y = Kine->Y_Welding;

//		// Phuong trinh duong thang //* dang vuong goc voi phuong trinh
//		float He_so_a = (Mang_Robot[1][1] - Mang_Robot[0][1])/(Mang_Robot[1][0] - Mang_Robot[0][0]);
//		float Temp_Path_1 = Mang_Robot[0][1] - He_so_a*Mang_Robot[0][0]; // b = y1 - ((y2-y1)/(x2-x1))*x1  // He so b duong thang chua 2 diem
//		float Temp_Path_2 = Kine->Y_Welding - tan(Kine->Theta_Real_Robot + PI/2)*Kine->X_Welding;  // b1 = y_robot - tan(theta + PI/2)*x_robot // He so b phuong trinh vuong goc voi robot
//		pos->x = (Temp_Path_2 - Temp_Path_1)/(He_so_a - tan(Kine->Theta_Real_Robot + PI/2));
//		pos->y = He_so_a*pos->x + Temp_Path_1;


}

// Ngat I2C Part 1: ESP32
void HAL_I2C_SlaveRxCpltCallback(I2C_HandleTypeDef *hi2c)
{
	HAL_I2C_Slave_Receive_IT(&hi2c1, RxData, RxSIZE);
    // Concatenate RxData into a single 32-bit variable
    a_00 = ((uint32_t)RxData[0] << 24) |
        ((uint32_t)RxData[1] << 16) |
        ((uint32_t)RxData[2] << 8) |
        (uint32_t)RxData[3];

    // Get the exponent value from RxData
    exponent = RxData[4];

    // Calculate mu and real_num values
    mu = pow(10, exponent);
    real_num = (float)((float)a_00/ mu);

    //    RxData[5] = 0000|0000   4 bit dau la x,y: 0001x 0010y   4 bit sau la ma ket thuc: 0001 gui tiep, 0110 ket thuc
    First_4_bits = (RxData[5] >> 4) & 0x0F; // Lay data and voi 0011|0000 de ra duoc 4 bit dau
    Second_4_bits = RxData[5] & 0x0F; // Lay data and voi 0000|0111 de ra duoc 4 bit sau

    if(Second_4_bits == 0x01 && bit_end == 0) // Ki hieu: tiep tuc gui
	{
    	if(First_4_bits == 0x01) // Neu la X
		{
    		Mang_quy_dao_X[Num_X] = real_num;
    		Mang_quy_dao_X_m[Num_X] = -1*Mang_quy_dao_X[Num_X] / 1000;
			Num_X = Num_X + 1;
		}
		else if(First_4_bits == 0x02) // Neu la Y
		{
			Mang_quy_dao_Y[Num_Y] = real_num;
			Mang_quy_dao_Y_m[Num_Y] = Mang_quy_dao_Y[Num_Y] / 1000;
			Num_Y = Num_Y + 1;
		}
	}
    else if(Second_4_bits == 0x06)
    {
    	if(First_4_bits == 0x01) // Neu la X
		{
    		Mang_quy_dao_X[Num_X] = real_num;
    		Mang_quy_dao_X_m[Num_X] = Mang_quy_dao_X[Num_X] / 1000;
			Num_X = Num_X + 1;
		}
		else if(First_4_bits == 0x02) // Neu la Y
		{
			Mang_quy_dao_Y[Num_Y] = real_num;
			Mang_quy_dao_Y_m[Num_Y] = Mang_quy_dao_Y[Num_Y] / 1000;
			Num_Y = Num_Y + 1;
		}

    	// Gan tat cac gia tri con lai bang 0
    	for(int i = Num_Y + 1; i<Max_Array_XY; i++)
    	{
    		Mang_quy_dao_X[Num_X] = 0;
    		Mang_quy_dao_Y[Num_Y] = 0;
    		Mang_quy_dao_X_m[Num_X] = 0;
    		Mang_quy_dao_Y_m[Num_Y] = 0;
    	}
    	Start_bit_1 = 1;
    	bit_end = 1;
    }
}

// Ngastw I2C Part 2
void HAL_I2C_AddrCallback(I2C_HandleTypeDef*hi2c,uint8_t TransferDirection,uint16_t AddrMatchCode)
{
		if(TransferDirection == I2C_DIRECTION_TRANSMIT)
		{
			HAL_I2C_Slave_Sequential_Receive_IT(hi2c,RxData, RxSIZE,I2C_FIRST_AND_LAST_FRAME);
		}
		else
		{
			Error_Handler();
		}
}




// Ngắt Timer
void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)
{
	if (htim -> Instance == TIM8)
	{
		HAL_GPIO_TogglePin(GPIOE, GPIO_PIN_15);
		//if(Start_bit_2 == 1 && Time_10 >= 0.5)
		//{
//		// Khai báo đư�?ng đi
//		//Test_duong_thang(pt_pos_1, 0.5, 0.1, pt_Kine->X_real, pt_Kine->Y_real); // Tính ra vị trí x, y và theta cho robot cần bám
//		pt_pos_1->x = (pt_Kine->Y_real - b)/(a);  // Cập nhật vị trí x quy hoạch
//		pt_pos_1->y = a * pt_pos_1->x + b;   // Cập nhật vị trí y quy hoạch
//		pt_pos_1->theta_tiep_tuyen = atan2f((a*(pt_pos_1->x + Delta_S) + b - pt_pos_1->y), Delta_S);  // Góc tiếp tuyến với quỹ đạo mà xe hướng đến
//
//		// Xử lý sai số để ra output PID system ra được sai số lưu vào ek
//		Processing_Error(pt_PID_theta, pt_PID_posision, pt_pos_1, pt_Kine->X_real, pt_Kine->Theta_Real_Robot);
//
//		// Tính Out put PID vị trí và tiếp tuyến ra được 2 hệ số K
//		PID_XY(pt_PID_posision); // PID vị trí
//		PID_XY(pt_PID_theta);  // PID góc tiếp tuyến
//
//		// Tính PID hệ thống ra biến K
//		//Output_K_PID(pt_Kine, pt_Robot, pt_Para_MR, pt_Para_ML, pt_PID_posision, pt_PID_theta);
//		Output_PID_K_0 = (pt_PID_posision->Output + pt_PID_theta->Output)/2.0;
//		pt_Kine->VR_Set =   Output_PID_K_0 * (pt_Robot->L / 2.0)   + pt_Kine->V_Set; // v1 = u1*L/2 + vconst;
//		pt_Kine->VL_Set = -(Output_PID_K_0 * (pt_Robot->L / 2.0))  + pt_Kine->V_Set; // v2 = -u1*L/2 + vconst;
//		pt_Kine->V_Set = (pt_Kine->VR_Set + pt_Kine->VL_Set)/2.0;  // v = (v1+v2)/2;
//		pt_Para_MR->SP_Rad_s = pt_Kine->VR_Set/pt_Robot->R;  //wr = v1/R;
//		pt_Para_ML->SP_Rad_s = pt_Kine->VL_Set/pt_Robot->R;  // wl = v2/R

		// �?�?c encoder động cơ trái và phải
		RPM_Calc(&htim3, pt_Para_MR);
		RPM_Calc(&htim4, pt_Para_ML);

		// PID cho động cơ trái và phải
		PID_control(&htim2, pt_Para_MR, TIM_CHANNEL_1);
		PID_control(&htim1, pt_Para_ML, TIM_CHANNEL_1);

		// �?ảo chi�?u khi e âm
		if(pt_Para_MR->Temp_PWM_1 >= 0)
		{
			Inverse_Right_Motor(0);
			pt_Para_MR->Out_PWM = (uint16_t)pt_Para_MR->Temp_PWM_1;
		}
		else if(pt_Para_MR->Temp_PWM_1 < 0)
		{
			Inverse_Right_Motor(1);
			pt_Para_MR->Out_PWM = (uint16_t)-pt_Para_MR->Temp_PWM_1;
		}
		if(pt_Para_ML->Out_fPWM >= 0)
		{
			Inverse_Left_Motor(0);
			pt_Para_ML->Out_PWM = (uint16_t)pt_Para_ML->Temp_PWM_1;
		}
		else if(pt_Para_ML->Out_fPWM < 0)
		{
			Inverse_Left_Motor(1);
			pt_Para_ML->Out_PWM = (uint16_t)-pt_Para_ML->Temp_PWM_1;
		}


//		/************************Fuzzy*************************/
//		// Xử lí RPM
//		pt_Para_MR->ek = (pt_Para_MR->SP_RPM - pt_Para_MR->RPM);	// Xác định sai số
//
//		// Input1 là sai số thông thư�?ng
//		e1 = pt_Para_MR->ek / 33.5;   // Chia cho 33.5 vì maximum velocity
//		Processing(e1, 5, IN_01, ID1, Value_ID_1);
//		// Input2 là tích luỹ sai số
//		error_integration_fuzzy = error_integration_fuzzy_P + (pt_Para_MR->ek*Time_Interrupt); // Tinhs ra sai số tích luỹ
//		e2 = error_integration_fuzzy/33.5;
//		// Khâu bão hoà của Fuzzy
//		if(error_integration_fuzzy_P>50)
//		{
//			error_integration_fuzzy_P = 50.0;
//		}
//		else if(error_integration_fuzzy_P<-50)
//		{
//			error_integration_fuzzy_P = -50.0;
//		}
//		Processing(e2, 5, IN_02, ID2, Value_ID_2);
//		//Xử lí luật đi�?u khiển
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 0 , Temp_01, 0, 0, 0);  // Rule 1 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 1 , Temp_01, 0, 1, 0);  // Rule 2 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 2 , Temp_01, 0, 2, 1);  // Rule 3 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 3 , Temp_01, 0, 3, 2);  // Rule 4 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 4 , Temp_01, 0, 4, 2);  // Rule 5 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 5 , Temp_01, 1, 0, 0);  // Rule 6 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 6 , Temp_01, 1, 1, 1);  // Rule 7 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 7 , Temp_01, 1, 2, 1);  // Rule 8 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 8 , Temp_01, 1, 3, 2);  // Rule 9 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 9 , Temp_01, 1, 4, 2);  // Rule 10 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 10, Temp_01, 2, 0, 1);  // Rule 11 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 11, Temp_01, 2, 1, 1);  // Rule 12 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 12, Temp_01, 2, 2, 2);  // Rule 13 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 13, Temp_01, 2, 3, 3);  // Rule 14 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 14, Temp_01, 2, 4, 4);  // Rule 15 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 15, Temp_01, 3, 0, 2);  // Rule 16 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 16, Temp_01, 3, 1, 2);  // Rule 17 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 17, Temp_01, 3, 2, 3);  // Rule 18 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 18, Temp_01, 3, 3, 4);  // Rule 19 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 19, Temp_01, 3, 4, 4);  // Rule 20 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 20, Temp_01, 4, 0, 2);  // Rule 21 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 21, Temp_01, 4, 1, 2);  // Rule 22 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 22, Temp_01, 4, 2, 4);  // Rule 23 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 23, Temp_01, 4, 3, 4);  // Rule 24 (0 0 1)
//	     Rule(ID1, ID2, OUT_01, Value_ID_1, Value_ID_2, 24, Temp_01, 4, 4, 4);  // Rule 25 (0 0 1)
//	     // Lưu kết quả vào biến Temp_01
//	     //Final_Value_FC(Output_PWM_Fuzzy_Temp, Temp_02, 25, Temp_01);
//	     // Sau khi tạo luật xong thì cộng dồn giá trị vào Final_Value
//
//	     //resset temp
//	     Temp_02[1] = 0;
//	     Temp_02[0] = 0;
//
//	     for(int i=0;i<25;i++)
//	     {
//	    	 Temp_02[0] = Temp_02[0] + Temp_01[i][0];
//	    	 Temp_02[1] = Temp_02[1] + Temp_01[i][1];
//	     }
//
//	     // Kết quả cuối cùng là chia tử với mẫu
//	     Output_PWM_Fuzzy_Temp = Temp_02[0] / Temp_02[1];
//	     Output_PWM_Fuzzy = Output_PWM_Fuzzy_Temp * 1000; // Nhân với độ gain là 1000 vì phân giải PWM là 1000
//
//	     // Xuất xung PWM PID vs Fuzzy
//	     __HAL_TIM_SET_COMPARE(&htim2, TIM_CHANNEL_1, pt_Para_MR->Out_PWM*0.95 + Output_PWM_Fuzzy*0.05);


	     // Xuất xung PWM PID
	     __HAL_TIM_SET_COMPARE(&htim2, TIM_CHANNEL_1, pt_Para_MR->Out_PWM);
	     __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, pt_Para_ML->Out_PWM);

	     // �?ộng h�?c thuận
	     //Forward_Kinematic(pt_Kine, pt_Robot, pt_Para_MR, pt_Para_ML);
	 	pt_Kine->V_real = (pt_Para_MR->Rad_s + pt_Para_ML->Rad_s)*(pt_Robot->R/2); // Tính vận tốc thực tế cho xe
	 	pt_Kine->W_Real = ((pt_Para_MR->Rad_s - pt_Para_ML->Rad_s)*pt_Robot->R)/(2*pt_Robot->L); // Tốc độ quay của robot hiện tại
	 	pt_Kine->X_dot = pt_Kine->V_real*cos(pt_Kine->Theta_Real_Robot); // x dot
	 	pt_Kine->Y_dot = pt_Kine->V_real*sin(pt_Kine->Theta_Real_Robot); // y dot
	 	// Tích phân để ra x,y hiện tại của robot
	 	pt_Kine->X_real = pt_Kine->X_real + pt_Kine->X_dot*Time_Interrupt; // Vị trí của robot phương X
	 	pt_Kine->Y_real = pt_Kine->Y_real + pt_Kine->Y_dot*Time_Interrupt; // Vị trí của robot phương Y

	 	// Chuyen sang mm
	 	pt_Kine->X_real_mm = pt_Kine->X_real * 1000;
	 	pt_Kine->Y_real_mm = pt_Kine->Y_real * 1000;

	 	// Welding
//	 	if(-PI/2 <= theta_robot <= PI/2)
//	 	    Xw = x_robot + d*cos(theta_robot) - (L+Delta_L)*sin(theta_robot);
//	 	    Yw = y_robot + (L+Delta_L)*cos(theta_robot) + d*sin(theta_robot);
//	 	else
//	 	    Xw = x_robot - d*cos(theta_robot - PI/2) - (L+Delta_L)*sin(theta_robot - PI/2);
//	 	    Yw = y_robot + (L+Delta_L)*cos(theta_robot - PI/2) + d*sin(theta_robot - PI/2);
//	 	end

	 	pt_Kine->Theta_Real_Robot = pt_Kine->Theta_Real_Robot + pt_Kine->W_Real * Time_Interrupt; // Cập nhật theta

	 	float Delta_L = 0;

//	 	if(pt_Kine->Theta_Real_Robot <= PI/2 && pt_Kine->Theta_Real_Robot >= -PI/2)
//	 	{
//	 		pt_Kine->X_Welding = pt_Kine->X_real + pt_Robot->Distance_X_tourch*cos(pt_Kine->Theta_Real_Robot) - (pt_Robot->Distance_Y_tourch+Delta_L)*sin(pt_Kine->Theta_Real_Robot);
//	 		pt_Kine->Y_Welding = pt_Kine->Y_real + (pt_Robot->Distance_Y_tourch+Delta_L)*cos(pt_Kine->Theta_Real_Robot) + pt_Robot->Distance_X_tourch*sin(pt_Kine->Theta_Real_Robot);
//	 	}
//	 	else
//		{
//			pt_Kine->X_Welding = pt_Kine->X_real - pt_Robot->Distance_X_tourch*cos(pt_Kine->Theta_Real_Robot - PI/2) - (pt_Robot->Distance_Y_tourch+Delta_L)*sin(pt_Kine->Theta_Real_Robot - PI/2);
//			pt_Kine->Y_Welding = pt_Kine->Y_real + (pt_Robot->Distance_Y_tourch+Delta_L)*cos(pt_Kine->Theta_Real_Robot - PI/2) + pt_Robot->Distance_X_tourch*sin(pt_Kine->Theta_Real_Robot - PI/2);
//		}
//	 	pt_Kine->X_Welding = pt_Kine->X_real + pt_Robot->Distance_X_tourch*cos(pt_Kine->Theta_Real_Robot) - (pt_Robot->Distance_Y_tourch+Delta_L)*sin(pt_Kine->Theta_Real_Robot);
//	 	pt_Kine->Y_Welding = pt_Kine->Y_real + (pt_Robot->Distance_Y_tourch+Delta_L)*cos(pt_Kine->Theta_Real_Robot) + pt_Robot->Distance_X_tourch*sin(pt_Kine->Theta_Real_Robot);

//	 	pt_Kine->X_Welding = pt_Kine->X_real + pt_Robot->Distance_X_tourch*cos(pt_Kine->Theta_Real_Robot) - (pt_Robot->Distance_Y_tourch+Stepper_L )*sin(pt_Kine->Theta_Real_Robot);
//	 	pt_Kine->Y_Welding = pt_Kine->Y_real + (pt_Robot->Distance_Y_tourch+Stepper_L)*cos(pt_Kine->Theta_Real_Robot) + pt_Robot->Distance_X_tourch*sin(pt_Kine->Theta_Real_Robot);

	 	pt_Kine->X_Welding = pt_Kine->X_real;
	 	pt_Kine->Y_Welding = pt_Kine->Y_real;

	     // Gán lại sai số
		error_integration_fuzzy_P = error_integration_fuzzy ;  // Gán sai số tích luỹ

		//UART_1(pt_Kine->X_real, pt_Kine->Y_real);
		//}


	}

	else if (htim->Instance == TIM6)
	{
		if(Start_bit_2 == 1)
		{
			// Khai báo đư�?ng đi
			//Test_duong_thang(pt_pos_1, 0.5, 0.1, pt_Kine->X_real, pt_Kine->Y_real); // Tính ra vị trí x, y và theta cho robot cần bám
	//		pt_pos_1->x = (pt_Kine->Y_real - b)/(a_0);  // Cập nhật vị trí x quy hoạch
	//		pt_pos_1->y = a_0 * pt_pos_1->x + b;   // Cập nhật vị trí y quy hoạch
	//		pt_pos_1->theta_tiep_tuyen = atan2f((a_0*(pt_pos_1->x + Delta_S) + b - pt_pos_1->y), Delta_S);  // Góc tiếp tuyến với quỹ đạo mà xe hướng đến
			// Test moi
	//		pt_pos_1->x = FC_1(pt_Kine->Y_real);
	//		pt_pos_1->y = pt_Kine->Y_real;
			//New method
			Path_planing(Mang_quy_dao_X_m, Mang_quy_dao_Y_m, Mang_Robot_1, pt_pos_1, pt_Kine, Vi_tri_1);
			//pt_pos_1->theta_tiep_tuyen = ((5.52*10^(-8)* (pt_pos_1->y+Delta_S)^4 - 5.456*10^(-5)*(pt_pos_1->y+Delta_S)^3 + 0.01686*(pt_pos_1->y+Delta_S)^2- 1.783*(pt_pos_1->y+Delta_S) + 309.7) - 5.52*10^(-8)* pt_pos_1->y^4 - 5.456*10^(-5)*pt_pos_1->y^3 + 0.01686*pt_pos_1->y^2- 1.783*pt_pos_1->y + 309.7)/Delta_S;
			pt_pos_1->theta_tiep_tuyen = atan2(Mang_Robot_1[1][1] - Mang_Robot_1[0][1],Mang_Robot_1[1][0]-Mang_Robot_1[0][0]);

			// Xử lý sai số để ra output PID system ra được sai số lưu vào ek
			Processing_Error(pt_PID_theta, pt_PID_posision, pt_pos_1, pt_Kine->X_Welding, pt_Kine->Theta_Real_Robot);
			ek_mm = pt_PID_posision->ek * 1000;
			ek_degree = pt_PID_theta->ek * 180/PI;

			float em = pt_PID_posision->ek*1000;

			//Time_10 = Time_10 + 0.2;

			if(em >= 20)
			{
				em = 20;
			}
			else if(em <= -20)
			{
				em = -20;
			}
			//Stepper_L = ((float)Counter_AC/200)*0.004;

			 //Stepper(em);


			// Tính Out put PID vị trí và tiếp tuyến ra được 2 hệ số K
			PID_XY(pt_PID_posision); // PID vị trí
			PID_XY(pt_PID_theta);  // PID góc tiếp tuyến

			// Tính PID hệ thống ra biến K
			//Output_K_PID(pt_Kine, pt_Robot, pt_Para_MR, pt_Para_ML, pt_PID_posision, pt_PID_theta);
			Output_PID_K_0 = (pt_PID_posision->Output + pt_PID_theta->Output)/2.0;
			pt_Kine->VR_Set =   Output_PID_K_0 * (pt_Robot->L / 2.0)   + pt_Kine->V_Set; // v1 = u1*L/2 + vconst;
			pt_Kine->VL_Set = -(Output_PID_K_0 * (pt_Robot->L / 2.0))  + pt_Kine->V_Set; // v2 = -u1*L/2 + vconst;
			pt_Kine->V_Set_1 = (pt_Kine->VR_Set + pt_Kine->VL_Set)/2.0;  // v = (v1+v2)/2;
			pt_Para_MR->SP_Rad_s = pt_Kine->VR_Set/pt_Robot->R;  //wr = v1/R;
			pt_Para_ML->SP_Rad_s = pt_Kine->VL_Set/pt_Robot->R;  // wl = v2/R
			}

	}
	else if (htim->Instance == TIM10)
	{
//		float em = pt_PID_posision->ek*1000;
//
//		Time_10 = Time_10 + 0.2;
//
////		Stepper_L = Stepper_L + em*Time_10;
//		if(em >= 20)
//		{
//			em = 20;
//		}
//		else if(em <= -20)
//		{
//			em = -20;
//		}
//		Stepper_L = ((float)Counter_AC/200)*0.004;
//
//		 Stepper(em);


	}
	else if (htim->Instance == TIM11)
	{
		//Time_10 = Time_10 + 0.01;
		if(Start_bit_1 == 1)
		  {
			  Time_10 = Time_10 + 0.01;
		  }
		if(Start_bit_1 == 1 && Time_10 < 0.1)
		{
			  // New method
			  pt_Kine->X_Welding = Mang_quy_dao_X_m[0];
			  pt_Kine->Y_Welding = Mang_quy_dao_Y_m[0];
			  pt_Kine->X_real = pt_Kine->X_Welding;
			  pt_Kine->Y_real = pt_Kine->Y_Welding;
			  float Delta_L = 0;
//			  pt_Kine->X_real = -pt_Kine->X_Welding + pt_Robot->Distance_X_tourch*cos(pt_Kine->Theta_Real_Robot) - (pt_Robot->Distance_Y_tourch+Delta_L)*sin(pt_Kine->Theta_Real_Robot);
//			  pt_Kine->Y_real = -pt_Kine->Y_Welding + (pt_Robot->Distance_Y_tourch+Delta_L)*cos(pt_Kine->Theta_Real_Robot) + pt_Robot->Distance_X_tourch*sin(pt_Kine->Theta_Real_Robot);
			  for(int i=0; i<2; i++)
			  {
				  Mang_Robot_1[i][0] = Mang_quy_dao_X_m[Vi_tri_1 + i];
				  Mang_Robot_1[i][1] = Mang_quy_dao_Y_m[Vi_tri_1 + i];
			  }
			  Start_bit_2 = 1;
		  }
	}
}
/* USER CODE END 4 */

/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */
void Error_Handler(void)
{
  /* USER CODE BEGIN Error_Handler_Debug */
  /* User can add his own implementation to report the HAL error return state */
  __disable_irq();
  while (1)
  {
  }
  /* USER CODE END Error_Handler_Debug */
}

#ifdef  USE_FULL_ASSERT
/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(uint8_t *file, uint32_t line)
{
  /* USER CODE BEGIN 6 */
  /* User can add his own implementation to report the file name and line number,
     ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
  /* USER CODE END 6 */
}
#endif /* USE_FULL_ASSERT */
